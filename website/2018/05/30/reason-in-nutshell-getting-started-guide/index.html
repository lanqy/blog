<!--
 * @Author: Leland
 * @Date: 2019-12-27 15:59:00
 * @Description: Description
 -->
<!doctype html>
<html>

  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui" />
    <title>Reason 入门手册</title>
    <link href="/css/style.css" rel="stylesheet" />
    <meta name="description" content="Reason 入门手册">
  </head>

  <body>
    <div>
      <div>
        <header class="header">
          <div class="container header-wrap">
            <h1 class="site-name">
              <a href="/">
                首页
              </a>
            </h1>
            <ul class="nav">
              <li class="nav-item">
                <a href="/about">关于</a>
              </li>
            </ul>
          </div>
        </header>
      </div>
      <div class="container main">
        <div class="page-body">
          <div class="markdown-body">
            <h1>Reason 入门手册</h1>
            <p>译自：<a href="https://zaiste.net/reason_in_nutshell_getting_started_guide/">https://zaiste.net/reason_in_nutshell_getting_started_guide/</a></p>
            <p><img src="/images/zaiste-reason.png" alt="Reason"></p>
            <blockquote>
              <p>本教程旨在提供对 Reason 的全面但相对较短的介绍。</p>
            </blockquote>
            <p><a href="https://reasonml.github.io/">Reason</a> 是一种构建在 <a href="https://ocaml.org/">OCaml</a> 之上的编程语言。它提供了函数式和面向对象的功能，并且具有类型安全性并关注性能。它是在 Facebook 创建的。它的语法与 JavaScript 类似。目的是使 JavaScript 与 JavaScript 程序员的互操作更容易。Reason 可以访问 JavaScript 和 OCaml 生态系统。OCaml 创建于 1996 年，它是一种具有类型推导的函数式编程语言。</p>
            <p>Reason 网站包含一个<a href="https://reasonml.github.io/en/try.html">在线游乐场</a>。它允许使用该语言并直观的查看生成的 JavaScript。它也可以从 OCaml 转换为 Reason。</p>
            <h2>为什么</h2>
            <ul>
              <li>在 JavaScript 类型注释中，linting 或统一格式是作为外部依赖项提供的，例如 Flow，TypeScript，ESLint 或 Prettier。Reason 提供了这些功能的开箱即用。这使得开发过程更加简化和方便。</li>
              <li>Reason 提供对 <a href="https://reasonml.github.io/reason-react/">ReasonReact</a> 的 React 支持。它还支持 JSX 语法（ React 中使用的类似 HTML 的语法）。开箱即用</li>
              <li>Reason 还有生成本机二进制文件的能力。生成的代码是高性能的。没有虚拟机开销。它提供了一个便于部署过程的二进制文件。</li>
            </ul>
            <h2>它是如何工作的</h2>
            <p>Reason 被编译为 OCaml 的抽象语法树。这使 Reason 成为一个转译器。 OCaml 不能直接在浏览器中运行。AST 可以转换为各种目标。可以使用 BuckleScript 将 AST 编译为 JavaScript。它还提供了 OCaml 和 JavaScript 生态系统之间的互操作。</p>
            <p>BuckleScript 速度极快，可生成可读的 JavaScript。它还提供了外部函数接口（FFI）以允许与 JavaScript 现有库的互操作性。检查<a href="https://github.com/neonsquare/bucklescript-benchmark">BuckleScript 基准</a>。 BuckleScript 由 Messanger 团队在 Facebook 上使用，在 WebAssembly spec 解释器上由 Google 使用。在这里检查 Bucklescript 演示。 BuckleScript 由 <a href="https://twitter.com/bobzhang1988/">Hongbo Zhang</a> 创建。</p>
            <h2>你好 Reason</h2>
            <p>我们将使用 BuckleScript 生成一个 Reason 项目。该工具提供即时可用的项目模板，称为 <code>themes</code>。</p>
            <p>我们先从全局安装 <code>bs-platform</code> 开始：</p>
            <pre><code class="language-ocaml">npm install <span class="token operator">-</span>g bs<span class="token operator">-</span>platform
</code></pre>
            <p>我们现在可以使用 <code>bs-platform</code> 提供的 <code>bsb</code> 二进制文件生成项目脚手架。我们将使用 <code>basic-reason</code> 模板从最基本的 Reason 项目结构开始。</p>
            <pre><code class="language-ocaml">bsb <span class="token operator">-</span>init reason<span class="token operator">-</span><span class="token number">1</span> <span class="token operator">-</span>theme basic<span class="token operator">-</span>reason
</code></pre>
            <pre><code class="language-ocaml"><span class="token module variable">Making</span> directory reason<span class="token operator">-</span><span class="token number">1</span>
<span class="token module variable">Symlink</span> bs<span class="token operator">-</span>platform <span class="token keyword">in</span> <span class="token operator">/</span><span class="token module variable">Users</span><span class="token operator">/</span>zaiste<span class="token operator">/</span>code<span class="token operator">/</span>reason<span class="token operator">-</span><span class="token number">1</span>
</code></pre>
            <p>以下是通过 BuckleScript 从 <code>basic-reason</code> 模板生成的 Reason 目录结构：</p>
            <pre><code class="language-ocaml"><span class="token punctuation">.</span>
├── <span class="token module variable">README</span><span class="token punctuation">.</span>md
├── bsconfig<span class="token punctuation">.</span>json
├── lib
├── node_modules
├── package<span class="token punctuation">.</span>json
└── src
    └── <span class="token module variable">Demo</span><span class="token punctuation">.</span>re
</code></pre>
            <p><code>bsconfig.json</code> 包含 Reason 项目的 BuckleScript 配置。它允许指定要通过源编译的文件，通过 <code>bs-dependencies</code> 的 BuckleScript 依赖关系，编译器的附加标志等等。</p>
            <p>下一步是构建项目。这将采取 Reason 代码并通过 BuckleScript 传递它以生成 JavaScript。默认情况下，编译器将以 Node.js 为目标。</p>
            <pre><code class="language-ocaml">npm run build
</code></pre>
            <pre><code class="language-ocaml"><span class="token comment">(* 输出 *)</span>
<span class="token operator">></span> reason<span class="token operator">-</span><span class="token number">1</span><span class="token operator">@</span><span class="token number">0.1</span><span class="token punctuation">.</span><span class="token number">0</span> build <span class="token operator">/</span><span class="token module variable">Users</span><span class="token operator">/</span>zaiste<span class="token operator">/</span>code<span class="token operator">/</span>reason<span class="token operator">-</span><span class="token number">1</span>
<span class="token operator">></span> bsb <span class="token operator">-</span>make<span class="token operator">-</span>world

ninja<span class="token punctuation">:</span> <span class="token module variable">Entering</span> directory <span class="token variant variable">`lib</span><span class="token operator">/</span>bs'
<span class="token punctuation">[</span><span class="token number">3</span><span class="token operator">/</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token module variable">Building</span> src<span class="token operator">/</span><span class="token module variable">Demo</span><span class="token punctuation">.</span>mlast<span class="token punctuation">.</span>d
<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token module variable">Building</span> src<span class="token operator">/</span><span class="token module variable">Demo</span><span class="token operator">-</span><span class="token module variable">MyFirstReasonml</span><span class="token punctuation">.</span>cmj
</code></pre>
            <p>最后，我们可以使用 <code>node</code> 来运行 由 BuckleScript 生成的文件。</p>
            <pre><code class="language-ocaml">node src<span class="token operator">/</span><span class="token module variable">Demo</span><span class="token punctuation">.</span>bs<span class="token punctuation">.</span>js

<span class="token comment">(* 将输出 Hello, BuckleScript and Reason! *)</span>
</code></pre>
            <h2>语法 101</h2>
            <p>在本节中，我将详细介绍我发现的特殊的，新的或不同的语法元素。</p>
            <h3>模块</h3>
            <p>Reason 文件是模块。在 JavaScript 或类似的编程语言中没有 <code>require</code> 或 <code>import</code> 语句。模块定义必须以模块名称作为前缀以在外部工作。该功能来自 OCaml 。因此，您可以自由移动文件系统中的模块文件，而无需修改代码。</p>
            <h3>函数</h3>
            <p>函数使用 <code>let</code> 和 <code>=&gt;</code> 来定义。</p>
            <pre><code class="language-ocaml"><span class="token keyword">let</span> greet <span class="token operator">=</span> name <span class="token operator">=></span>
    <span class="token module variable">Js</span><span class="token punctuation">.</span>log<span class="token punctuation">(</span><span class="token string">"Hello, "</span> <span class="token operator">++</span> name <span class="token operator">++</span> <span class="token string">"!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

greet<span class="token punctuation">(</span><span class="token string">"Zaiste"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
            <p><code>++</code> 运算符用于连接字符串。</p>
            <p>函数的输入参数可以被标记。这使得函数调用更加明确：传入的值不再需要遵循函数定义中的参数顺序。用 <code>~</code> 作为参数名称的前缀使其标记。</p>
            <pre><code class="language-ocaml"><span class="token keyword">let</span> greet <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token label function">~name</span><span class="token punctuation">,</span> <span class="token label function">~location</span><span class="token punctuation">)</span> <span class="token operator">=></span>
    <span class="token module variable">Js</span><span class="token punctuation">.</span>log<span class="token punctuation">(</span><span class="token string">"Hello, "</span> <span class="token operator">++</span> name <span class="token operator">++</span> <span class="token string">"! You're in "</span> <span class="token operator">++</span> location<span class="token punctuation">)</span><span class="token punctuation">;</span>

greet<span class="token punctuation">(</span><span class="token label function">~location</span><span class="token operator">=</span><span class="token string">"Vienna"</span><span class="token punctuation">,</span> <span class="token label function">~name</span><span class="token operator">=</span><span class="token string">"Zaiste"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
            <h3>数据结构</h3>
            <h4>变体</h4>
            <p>变体是一个数据结构，它保存来自一组固定值的值。这也被称为标记或不相交联合或代数数据类型。变体中的每个案例都必须大写。可选，它可以接收参数。</p>
            <pre><code class="language-ocaml"><span class="token keyword">type</span> animal <span class="token operator">=</span> 
    <span class="token operator">|</span> <span class="token module variable">Dog</span>
    <span class="token operator">|</span> <span class="token module variable">Cat</span>
    <span class="token operator">|</span> <span class="token module variable">Bird</span><span class="token punctuation">;</span>
</code></pre>
            <h4>记录</h4>
            <p>这是一个记录</p>
            <pre><code class="language-ocaml"><span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">"Zaiste"</span><span class="token punctuation">,</span>
    age<span class="token punctuation">:</span> <span class="token number">13</span>
<span class="token punctuation">}</span>
</code></pre>
            <p>记录需要明确的类型定义。</p>
            <pre><code class="language-ocaml"><span class="token keyword">type</span> person <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> string<span class="token punctuation">,</span>
    age<span class="token punctuation">:</span> int
<span class="token punctuation">}</span>
</code></pre>
            <p>在模块的作用域中，类型将被继承：p 绑定将被识别为 <code>person</code> 类型。在模块之外，您可以通过在文件名前添加前缀来引用该类型。</p>
            <pre><code class="language-ocaml"><span class="token keyword">let</span> p<span class="token punctuation">:</span> <span class="token module variable">Person</span><span class="token punctuation">.</span>person <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">"Sean"</span><span class="token punctuation">,</span>
    age<span class="token punctuation">:</span> <span class="token number">12</span>
<span class="token punctuation">}</span>
</code></pre>
            <p>有一个约定为每个类型创建一个模块并将类型命名为 <code>t</code> 以避免重复，即用 <code>Person.t</code> 代替 <code>Person.person</code>。</p>
            <h3>异步编程和 Promise</h3>
            <p>通过 BuckleScript 提供的内置 Promise 支持，作为 JS.Promise 模块提供。以下是使用 <a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API">Fetch API</a> 进行 API 调用的示例：</p>
            <pre><code class="language-ocaml"><span class="token module variable">Js</span><span class="token punctuation">.</span><span class="token module variable">Promise</span><span class="token punctuation">.</span><span class="token punctuation">(</span>
    <span class="token module variable">Fetch</span><span class="token punctuation">.</span>fetch<span class="token punctuation">(</span>endpoint<span class="token punctuation">)</span>
    <span class="token operator">|></span> then_<span class="token punctuation">(</span><span class="token module variable">Fetch</span><span class="token punctuation">.</span><span class="token module variable">Response</span><span class="token punctuation">.</span>json<span class="token punctuation">)</span>
    <span class="token operator">|></span> then_<span class="token punctuation">(</span>json <span class="token operator">=></span> doSomethingOnReponse<span class="token punctuation">(</span>json<span class="token punctuation">)</span> <span class="token operator">|></span> resolve<span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre>
            <p>您需要使用 <code>then_</code> ，因为 <code>then</code> 是 OCaml 中的保留字。</p>
            <h3>模式匹配</h3>
            <p>模式匹配是基于提供值的形状的调度机制。在 Reason 中，模式匹配是通过 <code>switch</code> 语句实现的。它可以与变体类型或解构机制一起使用。</p>
            <pre><code class="language-ocaml">switch pet <span class="token punctuation">{</span>
    <span class="token operator">|</span> <span class="token module variable">Dog</span> <span class="token operator">=></span> <span class="token string">"woof"</span>
    <span class="token operator">|</span> <span class="token module variable">Cat</span> <span class="token operator">=></span> <span class="token string">"meow"</span>
    <span class="token operator">|</span> <span class="token module variable">Bird</span> <span class="token operator">=></span> <span class="token string">"chirp"</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
            <p>我们可以使用模式匹配进行列表解构：</p>
            <pre><code class="language-ocaml"><span class="token keyword">let</span> numbers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"1"</span><span class="token punctuation">,</span> <span class="token string">"2"</span><span class="token punctuation">,</span> <span class="token string">"3"</span><span class="token punctuation">,</span> <span class="token string">"4"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
switch numbers <span class="token punctuation">{</span>
    <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=></span> <span class="token string">"Empty"</span>
    <span class="token operator">|</span> <span class="token punctuation">[</span>n1<span class="token punctuation">]</span> <span class="token operator">=></span> <span class="token string">"Only one number: "</span> <span class="token operator">++</span> n1
    <span class="token operator">|</span> <span class="token punctuation">[</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">]</span> <span class="token operator">=></span> <span class="token string">"Only two numbers"</span>
    <span class="token operator">|</span> <span class="token punctuation">[</span>n1<span class="token punctuation">,</span> <span class="token punctuation">_</span><span class="token punctuation">,</span> n3<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>rest<span class="token punctuation">]</span> <span class="token operator">=></span> <span class="token string">"At least three numbers"</span>
<span class="token punctuation">}</span>
</code></pre>
            <p>或者，我们可以将其用于记录解构</p>
            <pre><code class="language-ocaml"><span class="token keyword">let</span> project <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">"Huncwot"</span><span class="token punctuation">,</span>
    size<span class="token punctuation">:</span> <span class="token number">101101</span><span class="token punctuation">,</span>
    forks<span class="token punctuation">:</span> <span class="token number">42</span><span class="token punctuation">,</span>
    deps<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">"axios"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">"sqlite3"</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

switch project <span class="token punctuation">{</span>
    <span class="token operator">|</span> <span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">"Huncwot"</span><span class="token punctuation">,</span> deps<span class="token punctuation">}</span> <span class="token operator">=></span> <span class="token string">"Matching by `name`"</span>
    <span class="token operator">|</span> <span class="token punctuation">{</span>location<span class="token punctuation">,</span> years<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">"axios"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>rest<span class="token punctuation">]</span><span class="token punctuation">}</span> <span class="token operator">=></span> <span class="token string">"Matching by one of `deps`"</span>
    <span class="token operator">|</span> project <span class="token operator">=></span> <span class="token string">"Any other situation"</span>
<span class="token punctuation">}</span>
</code></pre>
            <h3>可选值</h3>
            <p>option() 是 Reason 中描述 “ <code>nullable</code> (可空)” 值的内置变量：</p>
            <pre><code class="language-ocaml"><span class="token keyword">type</span> option<span class="token punctuation">(</span><span class="token type_variable function">'a</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token module variable">None</span> <span class="token operator">|</span> <span class="token module variable">Some</span><span class="token punctuation">(</span><span class="token type_variable function">'a</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
            <h3>不同</h3>
            <ul>
              <li><code>unit</code> 意味着“无”</li>
              <li><code>unit =&gt; unit</code> 是一个函数的签名，它不接受任何输入参数并且不返回任何值;主要用于回调函数</li>
            </ul>
            <h2>Reason 中的 React</h2>
            <h3>你好 ReasonReact</h3>
            <p><a href="https://reasonml.github.io/reason-react/">ReasonReact</a> 是一个 Reason 中用于创建 React 应用程序的内置功能。</p>
            <p>我们使用 BuckleScript 及其 <code>React</code> 模板创建一个 ReasonReact 项目。</p>
            <pre><code class="language-ocaml">bsb <span class="token operator">-</span>init reasonreact<span class="token operator">-</span><span class="token number">1</span> <span class="token operator">-</span>theme react
</code></pre>
            <p>Reason 团队推荐 ReasonReact 项目脚手架使用此方法。也可以使用带有 <a href="https://github.com/reasonml-community/reason-scripts">reason-scripts</a> 模板的 yarn 来获得更完整的起点。</p>
            <p>ReasonReact 提供了两种类型的组件：<code>statelessComponent</code> 和 <code>reducerComponent</code>。与 <code>stateless</code> (无状态)组件相反，<code>reducer</code> (减速器)组件是有状态的，提供类似 Redux 的 <code>reducer</code>。</p>
            <pre><code class="language-ocaml"><span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token module variable">ReasonReact</span><span class="token punctuation">.</span>string<span class="token punctuation">;</span>

<span class="token keyword">let</span> component <span class="token operator">=</span> <span class="token module variable">ReasonReact</span><span class="token punctuation">.</span>statelessComponent<span class="token punctuation">(</span><span class="token string">"App"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> make <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token label function">~message</span><span class="token punctuation">,</span> _children<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>component<span class="token punctuation">,</span>
    render<span class="token punctuation">:</span> _self <span class="token operator">=></span> 
        <span class="token operator">&lt;</span>h1 className<span class="token operator">=</span><span class="token string">"header"</span><span class="token operator">></span><span class="token punctuation">(</span>s<span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&lt;/</span>h1<span class="token operator">></span>
<span class="token punctuation">}</span>
</code></pre>
            <p>如前所述 <code>~</code> 指定一个带标号的参数来自由排序函数的输入参数。绑定名称中的 <code>_</code> 告诉编译器该函数的主体中未使用该参数。扩展运算符（<code>...</code>）与 <code>component</code> (组件)一起意味着我们扩展了现有的组件。在这个例子中，我们也重写（覆盖）了 <code>render</code> 函数。</p>
            <p>Reason 中的 JSX 比 React 更严格：我们需要使用 <code>ReasonReact.string()</code> 显式包装字符串。</p>
            <h3>构建非平凡的 ReasonReact 应用程序</h3>
            <p>让我们构建一个超越显示预定义数据的 ReasonReact 应用程序。我们将为趋势库创建一个 GitHub 查看器。目的是展示如何与外部 API 集成，如何管理状态以及如何使用 React 的生命周期方法的方法。</p>
            <p>为了这个例子的目的，我们将使用 <a href="https://github.com/reasonml-community/reason-scripts">reason-scripts</a> 来引导我们的 Reason 项目。</p>
            <pre><code class="language-ocaml">yarn create react<span class="token operator">-</span>app reasonreact<span class="token operator">-</span>github <span class="token operator">--</span>scripts<span class="token operator">-</span>version reason<span class="token operator">-</span>scripts
</code></pre>
            <p>安装依赖</p>
            <pre><code class="language-ocaml">cd reasonreact<span class="token operator">-</span>github
yarn
</code></pre>
            <p>从以下开始：</p>
            <pre><code class="language-ocaml">yarn start
</code></pre>
            <p>***存储库***是这个应用程序的中心概念。我们首先定义一个描述该实体的类型。我们将把它放在一个名为 Repo 的单独模块中。</p>
            <pre><code class="language-ocaml"><span class="token keyword">type</span> t <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> string<span class="token punctuation">,</span>
    size<span class="token punctuation">:</span> int<span class="token punctuation">,</span>
    forks<span class="token punctuation">:</span> int
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
            <p>从现在开始，我们可以从应用程序中的任何 Reason 文件引用此类型的 <code>Repo.t</code>，而不需要 requiring（引入）它。</p>
            <h3>管理状态</h3>
            <p>我们已经看到了一个无状态的组件。现在让我们创建一个具有状态的组件。在我们的上下文中，我们将使用 <code>RepoList</code> 组件管理从 GitHub 的 API 中获取的趋势库列表。</p>
            <p>首先定义由 <code>RepoList</code> 组件管理的状态的类型。</p>
            <pre><code class="language-ocaml"><span class="token keyword">type</span> state <span class="token operator">=</span> <span class="token punctuation">{</span>
    repos<span class="token punctuation">:</span> list<span class="token punctuation">(</span><span class="token module variable">Repo</span><span class="token punctuation">.</span>t<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
            <p>但是，有一个问题。最初，在从 GitHub API 获取趋势库列表之前，<code>repos</code> 是未定义的。Reason 类型系统不允许我们有 <code>undefined</code> (未定义) 的值。我们可以用一个空列表来模拟初始状态，但这不是最优的。空列表还可能意味着我们对提取趋势库的查询没有返回任何结果。</p>
            <p>让我们使用 Reason 的可选值来处理这种情况。</p>
            <pre><code class="language-ocaml"><span class="token keyword">type</span> state <span class="token operator">=</span> <span class="token punctuation">{</span>
    repos<span class="token punctuation">:</span> option<span class="token punctuation">(</span>list<span class="token punctuation">(</span><span class="token module variable">Repo</span><span class="token punctuation">.</span>t<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
            <p>下一步是定义该组件的可能操作。在ReasonReact中， <code>actions</code> (操作)表示为变体。现在我们只会有一个名为 <code>ReposFetched</code> 的 <code>action</code> (操作)。</p>
            <pre><code class="language-ocaml"><span class="token keyword">type</span> action <span class="token operator">=</span> 
    <span class="token operator">|</span> <span class="token module variable">ReposFetched</span><span class="token punctuation">(</span>list<span class="token punctuation">(</span><span class="token module variable">Repo</span><span class="token punctuation">.</span>t<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
            <p>为了在 ReasonReact 中创建一个有状态的组件，我们需要使用 <code>reducerComponent()</code> 函数。</p>
            <pre><code class="language-ocaml"><span class="token keyword">let</span> component <span class="token operator">=</span> <span class="token module variable">ReasonReact</span><span class="token punctuation">.</span>reducerComponent<span class="token punctuation">(</span><span class="token string">"App"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
            <p>这样的组件允许定义描述状态如何响应于 <code>actions</code> (动作)而被转换的 <code>reducer</code> (减速器)。Reducer将当前状态作为输入采取<code>actions</code> (动作)并将新状态作为输出返回。<code>reducer</code> (减速器)必须是纯粹的函数。</p>
            <pre><code class="language-ocaml">reducer<span class="token punctuation">:</span> <span class="token punctuation">(</span>action<span class="token punctuation">,</span> _prevState<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    switch action <span class="token punctuation">{</span>
        <span class="token operator">|</span> <span class="token module variable">ReposFetched</span><span class="token punctuation">(</span>repos<span class="token punctuation">)</span> <span class="token operator">=></span>
            <span class="token module variable">ReasonReact</span><span class="token punctuation">.</span><span class="token module variable">Update</span><span class="token punctuation">(</span><span class="token punctuation">{</span>repos<span class="token punctuation">:</span> <span class="token module variable">Some</span><span class="token punctuation">(</span>repos<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
            <p>基于我们在 <code>reducer()</code> 方法中收到的参数，我们是模式匹配 <code>action</code> (操作)。模式匹配必须是详尽的。所有变体值必须匹配。<code>reducer</code> 定义放置在组件的 <code>main</code> 函数中。</p>
            <p>为了完成组件的定义，我们来定义它的初始状态：</p>
            <pre><code class="language-ocaml">initialState<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    repos<span class="token punctuation">:</span> <span class="token module variable">Some</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            name<span class="token punctuation">:</span> <span class="token string">"Huncwot"</span><span class="token punctuation">,</span>
            size<span class="token punctuation">:</span> <span class="token number">101101</span><span class="token punctuation">,</span>
            forks<span class="token punctuation">:</span> <span class="token number">42</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
            <h3>与 API 集成</h3>
            <p>我们将使用 <a href="https://github.com/reasonml-community/bs-fetch">bs-fetch</a> 从外部 API 获取数据。它是一个 BuckleScript 库，充当 Fetch API 之上的一个薄层。一旦数据被提取，我们将使用 <code>bs-json</code> 来提取我们感兴趣的字段。</p>
            <p>开始安装 <code>bs-fetch</code> 和 <code>bs-json</code>：</p>
            <pre><code class="language-ocaml">npm i bs<span class="token operator">-</span>fetch <span class="token operator">@</span>glennsl<span class="token operator">/</span>bs<span class="token operator">-</span>json
</code></pre>
            <p>将它们添加到 <code>bsconfig.json</code> 中的 <code>bs-dependencies</code>：</p>
            <pre><code class="language-ocaml"><span class="token punctuation">{</span>
    <span class="token string">"bs-dependencies"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span>
        <span class="token string">"bs-fetch"</span><span class="token punctuation">,</span>
        <span class="token string">"@glennsl/bs-json"</span>
    <span class="token punctuation">]</span>s
<span class="token punctuation">}</span>
</code></pre>
            <p>我们将 Repo 类型定义为一组三个字段：<code>name</code>，<code>size</code> 和 <code>forks</code>。一旦从 GitHub API 获取有效载荷，我们就解析它以提取这三个字段。</p>
            <pre><code class="language-ocaml"><span class="token keyword">let</span> parse <span class="token operator">=</span> json <span class="token operator">=></span>
    <span class="token module variable">Json</span><span class="token punctuation">.</span><span class="token module variable">Decode</span><span class="token punctuation">.</span><span class="token punctuation">{</span>
        name<span class="token punctuation">:</span> json <span class="token operator">|></span> field<span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> string<span class="token punctuation">)</span><span class="token punctuation">,</span>
        size<span class="token punctuation">:</span> json <span class="token operator">|></span> field<span class="token punctuation">(</span><span class="token string">"size"</span><span class="token punctuation">,</span> int<span class="token punctuation">)</span><span class="token punctuation">,</span>
        forks<span class="token punctuation">:</span> json <span class="token operator">|></span> field<span class="token punctuation">(</span><span class="token string">"forks"</span><span class="token punctuation">,</span> int<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
</code></pre>
            <p><code>field</code> 是 <code>Json.Decode</code> 的一个方法。<code>Json.Decode.{...}</code>（注意这个点号）打开 <code>Json.Decode</code> 模块。它的属性现在可以在这些大括号内使用，而不需要使用 <code>Json.Decode</code> 作为前缀。</p>
            <p>由于 GitHub 在 <code>items</code> 下返回 <code>repos</code> ，我们定义另一个函数来获取该列表。</p>
            <pre><code class="language-ocaml"><span class="token keyword">let</span> extract <span class="token operator">=</span> <span class="token punctuation">(</span>fields<span class="token punctuation">,</span> json<span class="token punctuation">)</span> <span class="token operator">=></span>
    <span class="token module variable">Json</span><span class="token punctuation">.</span><span class="token module variable">Decode</span><span class="token punctuation">.</span><span class="token punctuation">(</span>
        json <span class="token operator">|></span> at<span class="token punctuation">(</span>field<span class="token punctuation">,</span> list<span class="token punctuation">(</span>parse<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
            <p>最后，我们可以发出请求并通过解析函数传递返回的数据：</p>
            <pre><code class="language-ocaml"><span class="token keyword">let</span> list <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> 
    <span class="token module variable">Js</span><span class="token punctuation">.</span><span class="token module variable">Promise</span><span class="token punctuation">.</span><span class="token punctuation">(</span>
        <span class="token module variable">Fetch</span><span class="token punctuation">.</span>fetch<span class="token punctuation">(</span>endpoint<span class="token punctuation">)</span>
        <span class="token operator">|></span> then_<span class="token punctuation">(</span><span class="token module variable">Fetch</span><span class="token punctuation">.</span><span class="token module variable">Response</span><span class="token punctuation">.</span>json<span class="token punctuation">)</span>
        <span class="token operator">|></span> then_<span class="token punctuation">(</span>text <span class="token operator">=></span> extract<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"items"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> text<span class="token punctuation">)</span> <span class="token operator">|></span> resolve<span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
            <h3>React 生命周期方法</h3>
            <p>让我们使用 <code>didMount</code> 生命周期方法触发从 GitHub API 获取存储库。</p>
            <pre><code class="language-ocaml">didMount<span class="token punctuation">:</span> self <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> handle <span class="token operator">=</span> repos <span class="token operator">=></span> self<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token module variable">ReposFetched</span><span class="token punctuation">(</span>repos<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token module variable">Repo</span><span class="token punctuation">.</span>list<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token operator">|></span> <span class="token module variable">Js</span><span class="token punctuation">.</span><span class="token module variable">Promise</span><span class="token punctuation">.</span>then_<span class="token punctuation">(</span>repos <span class="token operator">=></span> <span class="token punctuation">{</span>
        handle<span class="token punctuation">(</span>repos<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token module variable">Js</span><span class="token punctuation">.</span><span class="token module variable">Promise</span><span class="token punctuation">.</span>resolve<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">|></span> ignore<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
            <p><code>handle</code> 是一个将 <code>ReposFetched</code> 操作分派给 <code>reducer</code> 的方法。一旦承诺解决，操作将把获取的存储库传送到 <code>reducer</code> (减速器)。这将更新我们的状态。</p>
            <h3>渲染</h3>
            <p>由于我们区分了非初始化状态和存储空列表，因此处理初始***加载进度***消息很简单。</p>
            <pre><code class="language-ocaml">render<span class="token punctuation">:</span> self <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
    <span class="token punctuation">(</span>
        switch self<span class="token punctuation">.</span>state<span class="token punctuation">.</span>repos <span class="token punctuation">{</span>
            <span class="token operator">|</span> <span class="token module variable">None</span> <span class="token operator">=></span> s<span class="token punctuation">(</span><span class="token string">"Loading repositories..."</span><span class="token punctuation">)</span>
            <span class="token operator">|</span> <span class="token module variable">Some</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=></span> s<span class="token punctuation">(</span><span class="token string">"Empty list"</span><span class="token punctuation">)</span>
            <span class="token operator">|</span> <span class="token module variable">Some</span><span class="token punctuation">(</span>repos<span class="token punctuation">)</span> <span class="token operator">=></span>
            <span class="token operator">&lt;</span>ul<span class="token operator">></span>
            <span class="token punctuation">(</span>
                repos
                <span class="token operator">|></span> <span class="token module variable">List</span><span class="token punctuation">.</span>map<span class="token punctuation">(</span><span class="token punctuation">(</span>repo<span class="token punctuation">:</span> <span class="token module variable">Repo</span><span class="token punctuation">.</span>t<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token operator">&lt;</span>li<span class="token operator">></span> <span class="token punctuation">(</span>s<span class="token punctuation">(</span>repo<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;/</span>li<span class="token operator">></span><span class="token punctuation">)</span>
                <span class="token operator">|></span> <span class="token module variable">Array</span><span class="token punctuation">.</span>of_list
                <span class="token operator">|></span> <span class="token module variable">ReasonReact</span><span class="token punctuation">.</span>array
            <span class="token punctuation">)</span>
            <span class="token operator">&lt;/</span>ul<span class="token operator">></span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
    <span class="token operator">&lt;/</span>div<span class="token operator">></span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
            <h3>错误处理</h3>
            <p>无</p>
            <h3>CSS 中的类型</h3>
            <p>使用 <a href="https://github.com/SentiaAnalytics/bs-css">bs-css</a> 的 CSS 类型。</p>
            <p>通过 <code>yarn</code> 安装</p>
            <pre><code class="language-ocaml">yarn add bs<span class="token operator">-</span>css
</code></pre>
            <p>并将它添加到 <code>bsconfig.json</code> 中的 <code>bs-dependencies</code>：</p>
            <pre><code class="language-ocaml"><span class="token string">"bs-dependencies"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span>
  <span class="token string">"bs-css"</span>
<span class="token punctuation">]</span>
</code></pre>
            <p>组件：</p>
            <pre><code class="language-ocaml"><span class="token keyword">let</span> style <span class="token operator">=</span> 
    <span class="token module variable">Css</span><span class="token punctuation">.</span><span class="token punctuation">(</span>
        <span class="token punctuation">{</span>
            <span class="token string">"header"</span><span class="token punctuation">:</span> style<span class="token punctuation">(</span><span class="token punctuation">[</span>backgroundColor<span class="token punctuation">(</span>rgba<span class="token punctuation">(</span><span class="token number">111</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> display<span class="token punctuation">(</span><span class="token module variable">Flex</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">"title"</span><span class="token punctuation">:</span> style<span class="token punctuation">(</span><span class="token punctuation">[</span>color<span class="token punctuation">(</span>white<span class="token punctuation">)</span><span class="token punctuation">,</span> fontSize<span class="token punctuation">(</span>px<span class="token punctuation">(</span><span class="token number">28</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> fontWeight<span class="token punctuation">(</span><span class="token module variable">Bold</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> make <span class="token operator">=</span> _children <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>component<span class="token punctuation">,</span>
    render<span class="token punctuation">:</span> _self <span class="token operator">=></span>
    <span class="token operator">&lt;</span>header className<span class="token operator">=</span>style#<span class="token directive important">#header</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>h1 className<span class="token operator">=</span>style#<span class="token directive important">#title</span><span class="token operator">></span> <span class="token punctuation">(</span>s<span class="token punctuation">(</span><span class="token string">"This is title"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;/</span>h1<span class="token operator">></span>
    <span class="token operator">&lt;/</span>header<span class="token operator">></span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
            <h2>词汇</h2>
            <ul>
              <li><code>rtop</code> 是 Reason 的交互式命令行。</li>
              <li>Merlin 是 OCaml 和 Reason 的自动完成服务文件。</li>
              <li>[@bs…] FFI 的 Bucklescript 注释</li>
            </ul>
            <h2>其他资源</h2>
            <ul>
              <li><a href="https://github.com/vramana/awesome-reasonml">Awesome ReasonML</a></li>
              <li><a href="https://realworldocaml.org/">Real World OCaml</a></li>
              <li><a href="http://2ality.com/archive.html?tag=reasonml">http://2ality.com/archive.html?tag=reasonml</a></li>
              <li><a href="https://jamesfriend.com.au/a-first-reason-react-app-for-js-developers">https://jamesfriend.com.au/a-first-reason-react-app-for-js-developers</a></li>
              <li><a href="https://github.com/reasonml-community/reason-scripts">https://github.com/reasonml-community/reason-scripts</a></li>
              <li><a href="https://dev.to/jlewin_/reasonml-getting-started-53gi">https://dev.to/jlewin_/reasonml-getting-started-53gi</a></li>
              <li><a href="https://medium.com/@ryyppy/a-quick-look-on-my-reasonml-workflow-with-vscode-637685f9417a">https://medium.com/@ryyppy/a-quick-look-on-my-reasonml-workflow-with-vscode-637685f9417a</a></li>
              <li><a href="https://redex.github.io/">https://redex.github.io/</a></li>
              <li><a href="https://github.com/arecvlohe/reasonml-cheat-sheet">https://github.com/arecvlohe/reasonml-cheat-sheet</a></li>
              <li><a href="https://news.ycombinator.com/item?id=16500481">https://news.ycombinator.com/item?id=16500481</a></li>
              <li><a href="https://github.com/reasonml/reason-tools">ReasonTools browser extension</a></li>
            </ul>
            <h2>待定</h2>
            <pre><code class="language-ocaml"><span class="token keyword">module</span> <span class="token module variable">History</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">type</span> h<span class="token punctuation">;</span>
    <span class="token punctuation">[</span><span class="token operator">@</span>bs<span class="token punctuation">.</span>send<span class="token punctuation">]</span> <span class="token keyword">external</span> goBack <span class="token punctuation">:</span> h <span class="token operator">=></span> unit <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
    <span class="token punctuation">[</span><span class="token operator">@</span>bs<span class="token punctuation">.</span>send<span class="token punctuation">]</span> <span class="token keyword">external</span> goForward<span class="token punctuation">:</span> h <span class="token operator">=></span> unit <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
    <span class="token punctuation">[</span><span class="token operator">@</span>bs<span class="token punctuation">.</span>send<span class="token punctuation">]</span> <span class="token keyword">external</span> go <span class="token punctuation">:</span> <span class="token punctuation">(</span>h<span class="token punctuation">,</span> <span class="token label function">~jumps</span><span class="token punctuation">:</span> int<span class="token punctuation">)</span> <span class="token operator">=></span> unit <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
    <span class="token punctuation">[</span><span class="token operator">@</span>bs<span class="token punctuation">.</span>get<span class="token punctuation">]</span> <span class="token keyword">external</span> length <span class="token punctuation">:</span> h <span class="token operator">=></span> int <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
            <p>BuckleScript 允许我们将原始 JavaScript 与 Reason 代码混合使用。</p>
            <pre><code class="language-ocaml"><span class="token punctuation">[</span><span class="token operator">%</span>bs<span class="token punctuation">.</span>raw <span class="token punctuation">{</span><span class="token operator">|</span>require<span class="token punctuation">(</span>'<span class="token punctuation">.</span><span class="token operator">/</span>app<span class="token punctuation">.</span>css'<span class="token punctuation">)</span><span class="token operator">|</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre>

          </div>
        </div>
      </div>
    </div>
  </body>

</html>