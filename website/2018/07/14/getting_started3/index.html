<!--
 * @Author: Leland
 * @Date: 2019-12-27 15:59:00
 * @Description: Description
 -->
<!doctype html>
<html>

  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui" />
    <title>OCaml简介第3部分</title>
    <link href="/css/style.css" rel="stylesheet" />
    <meta name="description" content="OCaml简介第3部分">
  </head>

  <body>
    <div>
      <div>
        <header class="header">
          <div class="container header-wrap">
            <h1 class="site-name">
              <a href="/">
                首页
              </a>
            </h1>
            <ul class="nav">
              <li class="nav-item">
                <a href="/about">关于</a>
              </li>
            </ul>
          </div>
        </header>
      </div>
      <div class="container main">
        <div class="page-body">
          <div class="markdown-body">
            <h2>OCaml简介第3部分</h2>
            <p>译自：<a href="https://qiita.com/zenwerk/items/bfc1978718b5da3f463b">https://qiita.com/zenwerk/items/bfc1978718b5da3f463b</a></p>
            <h3>异常处理</h3>
            <p>它在您除以零或指定一个不存在的文件时发生。</p>
            <pre><code class="language-ocaml"># <span class="token number">1</span><span class="token operator">/</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token module variable">Exception</span><span class="token punctuation">:</span> <span class="token module variable">Division_by_zero</span><span class="token punctuation">.</span>
# open_in <span class="token string">""</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token module variable">Exception</span><span class="token punctuation">:</span> <span class="token module variable">Sys_error</span> <span class="token string">": No such file or directory"</span><span class="token punctuation">.</span>
</code></pre>
            <h4>抛出异常（ raise 表达式 ）</h4>
            <h5>raise 异常</h5>
            <h5>raise（ 异常参数 ）</h5>
            <p>如果异常需要参数，则（）是必需的。</p>
            <pre><code class="language-ocaml"># raise <span class="token module variable">Not_found</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token module variable">Exception</span><span class="token punctuation">:</span> <span class="token module variable">Not_found</span><span class="token punctuation">.</span>
# raise <span class="token punctuation">(</span><span class="token module variable">Sys_error</span> <span class="token string">": No such file or directory"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token module variable">Exception</span><span class="token punctuation">:</span> <span class="token module variable">Sys_error</span> <span class="token string">": No such file or directory"</span><span class="token punctuation">.</span>
# raise <span class="token punctuation">(</span><span class="token module variable">Sys_error</span> <span class="token string">": 我会抛出异常！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token module variable">Exception</span><span class="token punctuation">:</span> <span class="token module variable">Sys_error</span> <span class="token string">": ?\136\145?\154?\138\155?\135??\130常?\129"</span><span class="token punctuation">.</span>
</code></pre>
            <pre><code class="language-ocaml"># <span class="token keyword">let</span> <span class="token keyword">rec</span> fact n <span class="token operator">=</span>
    <span class="token keyword">if</span> n <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token keyword">then</span> raise <span class="token punctuation">(</span><span class="token module variable">Invalid_argument</span> <span class="token string">": negative argument"</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> n <span class="token operator">=</span> <span class="token number">0</span> <span class="token keyword">then</span> <span class="token number">1</span> <span class="token keyword">else</span> n <span class="token operator">*</span> fact <span class="token punctuation">(</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">val</span> fact <span class="token punctuation">:</span> int <span class="token operator">-></span> int <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token keyword">fun</span><span class="token operator">></span>
# fact <span class="token number">5</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">:</span> int <span class="token operator">=</span> <span class="token number">120</span>
# fact <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token module variable">Exception</span><span class="token punctuation">:</span> <span class="token module variable">Invalid_argument</span> <span class="token string">": negative argument"</span><span class="token punctuation">.</span>
</code></pre>
            <h4>异常处理( try with )</h4>
            <h5>try 表达式 with 异常1 -&gt; 表达式1 | …</h5>
            <pre><code class="language-ocaml"># <span class="token keyword">try</span> raise <span class="token module variable">Not_found</span> <span class="token keyword">with</span>
  <span class="token operator">|</span> <span class="token module variable">Not_found</span> <span class="token operator">-></span> <span class="token string">"not found !"</span>
  <span class="token operator">|</span> <span class="token punctuation">_</span> <span class="token operator">-></span> <span class="token string">"unknown !"</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">:</span> string <span class="token operator">=</span> <span class="token string">"not found !"</span>

<span class="token comment">(* 前面定义的 fact 函数例子 *)</span>
# <span class="token keyword">try</span> fact <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">with</span>
  <span class="token operator">|</span> <span class="token module variable">Invalid_argument</span> <span class="token punctuation">_</span> <span class="token operator">-></span> <span class="token number">0</span>
  <span class="token operator">|</span> <span class="token punctuation">_</span> <span class="token operator">-></span> <span class="token number">9999</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">:</span> int <span class="token operator">=</span> <span class="token number">0</span>
</code></pre>
            <h4>异常定义</h4>
            <p>异常类型的构造函数中称为异常构造函数。
              该变种是 exn 类型</p>
            <pre><code class="language-ocaml"><span class="token comment">(* 确认异常的变体类型 *)</span>
# <span class="token module variable">Not_found</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">:</span> exn <span class="token operator">=</span> <span class="token module variable">Not_found</span>
# raise<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">:</span> exn <span class="token operator">-></span> <span class="token type_variable function">'a</span> <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token keyword">fun</span><span class="token operator">></span>
</code></pre>
            <p>异常定义是为exn类型添加一个新的构造函数。</p>
            <p>exn类型是特殊的，你可以稍后添加一个构造函数。</p>
            <h5>exception 异常名</h5>
            <pre><code class="language-ocaml"><span class="token comment">(* 异常定义 *)</span>
# <span class="token keyword">exception</span> <span class="token module variable">Hoge</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">exception</span> <span class="token module variable">Hoge</span>
# <span class="token keyword">exception</span> <span class="token module variable">Fuga</span> <span class="token keyword">of</span> string<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">exception</span> <span class="token module variable">Fuga</span> <span class="token keyword">of</span> string
# raise <span class="token module variable">Hoge</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token module variable">Exception</span><span class="token punctuation">:</span> <span class="token module variable">Hoge</span><span class="token punctuation">.</span>
# raise <span class="token punctuation">(</span><span class="token module variable">Fuga</span> <span class="token string">"fuga!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token module variable">Exception</span><span class="token punctuation">:</span> <span class="token module variable">Fuga</span> <span class="token string">"fuga!"</span><span class="token punctuation">.</span>
</code></pre>
            <h4>关于exn类型</h4>
            <p>既然exn也是一个变体类型，它也可以作为一个参数传递。</p>
            <pre><code class="language-ocaml"># <span class="token keyword">exception</span> <span class="token module variable">Hoge</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">exception</span> <span class="token module variable">Hoge</span>

<span class="token comment">(* exn 类型列表 *)</span>
# <span class="token keyword">let</span> exnlist <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token module variable">Not_found</span><span class="token punctuation">;</span> <span class="token module variable">Hoge</span><span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token module variable">Invalid_argument</span> <span class="token string">"fuga"</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">val</span> exnlist <span class="token punctuation">:</span> exn list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token module variable">Not_found</span><span class="token punctuation">;</span> <span class="token module variable">Hoge</span><span class="token punctuation">;</span> <span class="token module variable">Invalid_argument</span> <span class="token string">"fuga"</span><span class="token punctuation">]</span>

<span class="token comment">(* 接收exn类型的函数 *)</span>
# <span class="token keyword">let</span> f <span class="token operator">=</span> <span class="token keyword">function</span>
  <span class="token operator">|</span> <span class="token module variable">Hoge</span> <span class="token operator">-></span> <span class="token string">"hoge!"</span>
  <span class="token operator">|</span> x <span class="token operator">-></span> raise x<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">val</span> f <span class="token punctuation">:</span> exn <span class="token operator">-></span> string <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token keyword">fun</span><span class="token operator">></span>
# f <span class="token module variable">Hoge</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">:</span> string <span class="token operator">=</span> <span class="token string">"hoge!"</span>
# f <span class="token module variable">Not_found</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token module variable">Exception</span><span class="token punctuation">:</span> <span class="token module variable">Not_found</span><span class="token punctuation">.</span>
</code></pre>
            <h3>unit 类型</h3>
            <p>输出字符串的程序。</p>
            <pre><code class="language-ocaml"># print_string <span class="token string">"hoge\n"</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
hoge
<span class="token operator">-</span> <span class="token punctuation">:</span> unit <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
            <p>返回类型是 unit 类型</p>
            <p>unit 类型的值只是一个名为（）的常量，称为 unit 值。</p>
            <h4>unit 类型的用法</h4>
            <ul>
              <li>（）上没有可以执行的操作</li>
              <li>用作返回值本身没有意义的函数的返回值</li>
              <li>在定义不需要有意义的参数的函数时用作参数</li>
            </ul>
            <pre><code class="language-ocaml"># <span class="token keyword">let</span> const <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">777</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">val</span> const <span class="token punctuation">:</span> unit <span class="token operator">-></span> int <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token keyword">fun</span><span class="token operator">></span>
# const <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">:</span> int <span class="token operator">=</span> <span class="token number">777</span>
</code></pre>
            <h5>用作判断操作是否成功的返回值</h5>
            <pre><code class="language-ocaml">（<span class="token operator">*</span>
   <span class="token punctuation">(</span><span class="token punctuation">)</span> 将匹配模式，如果操作成功，将返回单位类型。
   也就是说，如果匹配成功，则表示操作成功。
<span class="token operator">*</span>）
# <span class="token keyword">let</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token module variable">Bytes</span><span class="token punctuation">.</span>set <span class="token string">"Test"</span> <span class="token number">1</span> <span class="token string">'C'</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
</code></pre>
            <h3>可变的数据结构</h3>
            <h4>修改字符串</h4>
            <h5>“string”.[index] &lt;- ‘char’</h5>
            <pre><code class="language-ocaml"># <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token string">"life"</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">val</span> s <span class="token punctuation">:</span> string <span class="token operator">=</span> <span class="token string">"life"</span>
# s<span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&lt;-</span> <span class="token string">'v'</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">:</span> unit <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
# s<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">:</span> string <span class="token operator">=</span> <span class="token string">"live"</span>

<span class="token comment">(* String.set 弃用 *)</span>
# <span class="token keyword">let</span> f2 <span class="token operator">=</span> <span class="token string">"hoge"</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">val</span> f2 <span class="token punctuation">:</span> string <span class="token operator">=</span> <span class="token string">"hoge"</span>
# <span class="token module variable">Bytes</span><span class="token punctuation">.</span>set f2 <span class="token number">0</span> <span class="token string">'H'</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">:</span> unit <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
# f2<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">:</span> string <span class="token operator">=</span> <span class="token string">"Hoge"</span>
</code></pre>
            <h5>该操作操作参考目的地</h5>
            <pre><code class="language-ocaml"># <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token string">"hoge"</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">val</span> s <span class="token punctuation">:</span> string <span class="token operator">=</span> <span class="token string">"hoge"</span>
# <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token punctuation">(</span>s<span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">val</span> a <span class="token punctuation">:</span> string <span class="token operator">*</span> string <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">"hoge"</span><span class="token punctuation">,</span> <span class="token string">"hoge"</span><span class="token punctuation">)</span>
# <span class="token module variable">Bytes</span><span class="token punctuation">.</span>set s <span class="token number">3</span> <span class="token string">'E'</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">:</span> unit <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">(* 两者都被改变，因为参考目标是相同的 *)</span>
# a<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">:</span> string <span class="token operator">*</span> string <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">"hogE"</span><span class="token punctuation">,</span> <span class="token string">"hogE"</span><span class="token punctuation">)</span>
</code></pre>
            <h4>物理相等</h4>
            <h5>物理相等 =&gt; 比较数据地址时的平等性</h5>
            <ul>
              <li>使用 ==, !=</li>
            </ul>
            <h5>结构相等 =&gt; 平等作为价值进行比较</h5>
            <ul>
              <li>使用=，&lt;&gt;</li>
            </ul>
            <pre><code class="language-ocaml"># <span class="token keyword">let</span> s1 <span class="token operator">=</span> <span class="token string">"hoge"</span> <span class="token operator">and</span> s2 <span class="token operator">=</span> <span class="token string">"hoge"</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">val</span> s1 <span class="token punctuation">:</span> string <span class="token operator">=</span> <span class="token string">"hoge"</span>
<span class="token keyword">val</span> s2 <span class="token punctuation">:</span> string <span class="token operator">=</span> <span class="token string">"hoge"</span>
<span class="token comment">(* 结构相等 *)</span>
# s1 <span class="token operator">=</span> s2<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">:</span> bool <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token comment">(* 物理相等 *)</span>
# s1 <span class="token operator">==</span> s2<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">:</span> bool <span class="token operator">=</span> <span class="token boolean">false</span>
# s1 <span class="token operator">!=</span> s2<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">:</span> bool <span class="token operator">=</span> <span class="token boolean">true</span>
</code></pre>
            <h4>可修改的记录</h4>
            <ul>
              <li>修改记录 =&gt; 使用 mutable 关键字</li>
              <li>记录修改 =&gt; record.field &lt;- 值</li>
            </ul>
            <pre><code class="language-ocaml"># <span class="token keyword">type</span> account <span class="token operator">=</span> <span class="token punctuation">{</span>name<span class="token punctuation">:</span>string<span class="token punctuation">;</span><span class="token keyword">mutable</span> amount<span class="token punctuation">:</span>int<span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> account <span class="token operator">=</span> <span class="token punctuation">{</span> name <span class="token punctuation">:</span> string<span class="token punctuation">;</span> <span class="token keyword">mutable</span> amount <span class="token punctuation">:</span> int<span class="token punctuation">;</span> <span class="token punctuation">}</span>
# <span class="token keyword">let</span> ac <span class="token operator">=</span> <span class="token punctuation">{</span>name <span class="token operator">=</span> <span class="token string">"bob"</span><span class="token punctuation">;</span> amount <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">val</span> ac <span class="token punctuation">:</span> account <span class="token operator">=</span> <span class="token punctuation">{</span>name <span class="token operator">=</span> <span class="token string">"bob"</span><span class="token punctuation">;</span> amount <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">}</span>
# ac<span class="token punctuation">.</span>amount <span class="token operator">&lt;-</span> <span class="token number">999</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">:</span> unit <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
# ac<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">:</span> account <span class="token operator">=</span> <span class="token punctuation">{</span>name <span class="token operator">=</span> <span class="token string">"bob"</span><span class="token punctuation">;</span> amount <span class="token operator">=</span> <span class="token number">999</span><span class="token punctuation">}</span>
<span class="token comment">(* 不可改变 *)</span>
# <span class="token keyword">let</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> ac<span class="token punctuation">.</span>name <span class="token operator">&lt;-</span> <span class="token string">"Hoge"</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token module variable">Error</span><span class="token punctuation">:</span> <span class="token module variable">The</span> record field name is not <span class="token keyword">mutable</span>
<span class="token comment">(* 这样是可以的 *)</span>
# ac<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;-</span> <span class="token string">'B'</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">:</span> unit <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
# ac<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">:</span> account <span class="token operator">=</span> <span class="token punctuation">{</span>name <span class="token operator">=</span> <span class="token string">"Bob"</span><span class="token punctuation">;</span> amount <span class="token operator">=</span> <span class="token number">999</span><span class="token punctuation">}</span>
</code></pre>
            <h4>创建引用（ ref ）</h4>
            <ul>
              <li>创建引用 =&gt; ref函数</li>
              <li>引用获取 =&gt; !引用</li>
              <li>引用目标重写 =&gt; 引用 := 值</li>
            </ul>
            <pre><code class="language-ocaml"><span class="token comment">(* 创建引用 *)</span>
# <span class="token keyword">let</span> h <span class="token operator">=</span> ref <span class="token string">"Hoge"</span> <span class="token operator">and</span> f <span class="token operator">=</span> ref <span class="token string">"Fuga"</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">val</span> h <span class="token punctuation">:</span> string ref <span class="token operator">=</span> <span class="token punctuation">{</span>contents <span class="token operator">=</span> <span class="token string">"Hoge"</span><span class="token punctuation">}</span>
<span class="token keyword">val</span> f <span class="token punctuation">:</span> string ref <span class="token operator">=</span> <span class="token punctuation">{</span>contents <span class="token operator">=</span> <span class="token string">"Fuga"</span><span class="token punctuation">}</span>

<span class="token comment">(* 引用获取 *)</span>
# <span class="token keyword">let</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> print_string <span class="token punctuation">(</span><span class="token operator">!</span>h <span class="token operator">^</span> <span class="token operator">!</span>f <span class="token operator">^</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token module variable">HogeFuga</span>

<span class="token comment">(* 引用重写 *)</span>
# h <span class="token operator">:=</span> <span class="token operator">!</span>f<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">:</span> unit <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
# <span class="token keyword">let</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> print_string <span class="token punctuation">(</span><span class="token operator">!</span>h <span class="token operator">^</span> <span class="token operator">!</span>f <span class="token operator">^</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token module variable">FugaFuga</span>
</code></pre>
            <h4>引用的引用 ( ref ref )</h4>
            <p>它也可以像C语言中的双指针一样</p>
            <pre><code class="language-ocaml"><span class="token comment">(* 创建引用 *)</span>
# <span class="token keyword">let</span> r1 <span class="token operator">=</span> ref <span class="token number">5</span> <span class="token operator">and</span> r2 <span class="token operator">=</span> ref <span class="token number">2</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">val</span> r1 <span class="token punctuation">:</span> int ref <span class="token operator">=</span> <span class="token punctuation">{</span>contents <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">}</span>
<span class="token keyword">val</span> r2 <span class="token punctuation">:</span> int ref <span class="token operator">=</span> <span class="token punctuation">{</span>contents <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">}</span>
<span class="token comment">(* 引用的引用创建 *)</span>
# <span class="token keyword">let</span> rr1 <span class="token operator">=</span> ref r1 <span class="token operator">and</span> rr2 <span class="token operator">=</span> ref r2<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">val</span> rr1 <span class="token punctuation">:</span> int ref ref <span class="token operator">=</span> <span class="token punctuation">{</span>contents <span class="token operator">=</span> <span class="token punctuation">{</span>contents <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token keyword">val</span> rr2 <span class="token punctuation">:</span> int ref ref <span class="token operator">=</span> <span class="token punctuation">{</span>contents <span class="token operator">=</span> <span class="token punctuation">{</span>contents <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token comment">(* 引用操作 *)</span>
# <span class="token keyword">let</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">!</span>rr1 <span class="token operator">:=</span> <span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">!</span>rr2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
# <span class="token punctuation">(</span><span class="token operator">!</span>r1<span class="token punctuation">,</span> <span class="token operator">!</span>r2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">:</span> int <span class="token operator">*</span> int <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
</code></pre>
            <h4>数组</h4>
            <ul>
              <li>[|值1;值2; … |]</li>
              <li>引用元素 =&gt; [| … |].( 下标 )</li>
              <li>改变数组元素 =&gt; [| … |].( 下标 ) &lt;- value</li>
            </ul>
            <p>数组的长度是固定的。</p>
            <p>您可以通过下标直接获取任何元素。</p>
            <h3>程序控制结构</h3>
            <p>作为OCaml的规范，参数的评估顺序是未定义的。</p>
            <p>因此，准备了用于像过程性语言那样控制执行顺序的语法。</p>
            <h4>顺序执行</h4>
            <h5>表达式1; 表达式2; … 表达式n</h5>
            <p>与如下如下代码一样</p>
            <pre><code class="language-ocaml"><span class="token keyword">let</span> <span class="token punctuation">_</span> <span class="token operator">=</span> 表达式<span class="token number">1</span> <span class="token keyword">in</span>
<span class="token keyword">let</span> <span class="token punctuation">_</span> <span class="token operator">=</span> 表达式<span class="token number">2</span> <span class="token keyword">in</span>
<span class="token punctuation">.</span>
<span class="token punctuation">.</span>
<span class="token punctuation">.</span>
表达式n
</code></pre>
            <p>最后的表达式n是整个返回值。</p>
            <h4>begin 与 end</h4>
            <p>你可以写 begin 表达式1; …表达式n end ，而不是（表达式; …表达式n）</p>
            <p>这似乎是首选。</p>
            <h4>ignore</h4>
            <p>如果相当于一个句子的表达式返回非 unit 类型，则会出现警告</p>
            <p>忽略警告的函数</p>
            <pre><code class="language-ocaml"><span class="token comment">(* 将返回值设置为0（int） *)</span>
# <span class="token keyword">let</span> print_hello <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> print_string <span class="token string">"Hello, "</span><span class="token punctuation">;</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">val</span> print_hello <span class="token punctuation">:</span> unit <span class="token operator">-></span> int <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token keyword">fun</span><span class="token operator">></span>

<span class="token comment">(* 警告出现在 print_hello *)</span>
# print_hello <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> print_string <span class="token string">"World\n"</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token module variable">Warning</span> <span class="token number">10</span><span class="token punctuation">:</span> this expression should have <span class="token keyword">type</span> unit<span class="token punctuation">.</span>
<span class="token module variable">Hello</span><span class="token punctuation">,</span> <span class="token module variable">World</span>
<span class="token operator">-</span> <span class="token punctuation">:</span> unit <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">(* 忽略不发出警告 *)</span>
# ignore <span class="token punctuation">(</span>print_hello <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> print_string <span class="token string">"World\n"</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token module variable">Hello</span><span class="token punctuation">,</span> <span class="token module variable">World</span>
<span class="token operator">-</span> <span class="token punctuation">:</span> unit <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
            <p>;是一个分隔符</p>
            <p>;不是终止符，它被用作分隔符。</p>
            <p>因此，要小心如果在表达式n的末尾添加一个分号作为表达式n，经常会出现额外的错误。</p>
            <h4>条件语句</h4>
            <p>if then 的 then 子句的返回值是（），则else可以省略。</p>
            <p>if 表达式1 then 表达式2 =&gt; if 表达式1 then 表达式2 else（）</p>
            <p>这意味着如果表达式1不成立，将会做任何事情。</p>
            <h4>循环语句</h4>
            <p>for 和 while 语句</p>
            <h5>for</h5>
            <p>for =&gt; for variable = start_value to end_value do 表达式 done</p>
            <p>或</p>
            <p>for variable = start_value downto end_value do 表达式 done</p>
            <pre><code class="language-ocaml"><span class="token comment">(* for 循环 *)</span>
# <span class="token keyword">for</span> i <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">to</span> <span class="token number">10</span> <span class="token keyword">do</span> <span class="token keyword">begin</span> print_int i<span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">end</span> <span class="token keyword">done</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token number">12345678910</span><span class="token operator">-</span> <span class="token punctuation">:</span> unit <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
# <span class="token keyword">for</span> i <span class="token operator">=</span> <span class="token number">10</span> <span class="token keyword">downto</span> <span class="token number">1</span> <span class="token keyword">do</span> <span class="token keyword">begin</span> print_int i<span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">end</span> <span class="token keyword">done</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token number">10987654321</span><span class="token operator">-</span> <span class="token punctuation">:</span> unit <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
            <h5>while</h5>
            <p>while 条件 do 表达式 done</p>
            <p>while据说它用得不多。</p>
            <pre><code class="language-ocaml"><span class="token keyword">let</span> quit_loop <span class="token operator">=</span> ref <span class="token boolean">false</span> <span class="token keyword">in</span>
  <span class="token keyword">while</span> not <span class="token operator">!</span>quit_loop <span class="token keyword">do</span>
  print_string <span class="token string">"Have you had enough yet? (y/n) "</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> str <span class="token operator">=</span> read_line <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">in</span>
  <span class="token keyword">if</span> str<span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'y'</span> <span class="token keyword">then</span>
      quit_loop <span class="token operator">:=</span> <span class="token boolean">true</span>
  <span class="token keyword">done</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token module variable">Have</span> you had enough yet<span class="token operator">?</span> <span class="token punctuation">(</span>y<span class="token operator">/</span>n<span class="token punctuation">)</span> n
<span class="token module variable">Have</span> you had enough yet<span class="token operator">?</span> <span class="token punctuation">(</span>y<span class="token operator">/</span>n<span class="token punctuation">)</span> y
<span class="token operator">-</span> <span class="token punctuation">:</span> unit <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>

          </div>
        </div>
      </div>
    </div>
  </body>

</html>