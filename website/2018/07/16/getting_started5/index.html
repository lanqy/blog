<!--
 * @Author: Leland
 * @Date: 2019-12-27 15:59:00
 * @Description: Description
 -->
<!doctype html>
<html>

  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui" />
    <title>OCaml简介第5部分</title>
    <link href="/css/style.css" rel="stylesheet" />
    <meta name="description" content="OCaml简介第5部分">
  </head>

  <body>
    <div>
      <div>
        <header class="header">
          <div class="container header-wrap">
            <h1 class="site-name">
              <a href="/">
                首页
              </a>
            </h1>
            <ul class="nav">
              <li class="nav-item">
                <a href="/about">关于</a>
              </li>
            </ul>
          </div>
        </header>
      </div>
      <div class="container main">
        <div class="page-body">
          <div class="markdown-body">
            <h2>OCaml简介第5部分</h2>
            <p>译自：<a href="https://qiita.com/zenwerk/items/3844df72c5f4afb1782f">https://qiita.com/zenwerk/items/3844df72c5f4afb1782f</a></p>
            <h3>面向对象的功能</h3>
            <h4>类声明</h4>
            <p>object … end</p>
            <p>OCaml实例变量的所有成员都是私有的</p>
            <pre><code class="language-ocaml"># <span class="token keyword">class</span> point ini_x ini_y <span class="token operator">=</span>
    <span class="token keyword">object</span> <span class="token punctuation">(</span>self<span class="token punctuation">)</span>  <span class="token comment">(* 自身の名前をつける, 自由なので this とかでも良い *)</span>
      <span class="token keyword">val</span> <span class="token keyword">mutable</span> x <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">(* 实例变量不能从外部访问 *)</span>
      <span class="token keyword">val</span> <span class="token keyword">mutable</span> y <span class="token operator">=</span> <span class="token number">0</span>

      <span class="token comment">(*
       * 实例方法
       * method 方法名称 参数... = 表达式
       *)</span>
      <span class="token keyword">method</span> set new_x new_y <span class="token operator">=</span> <span class="token keyword">begin</span> x <span class="token operator">&lt;-</span> new_x<span class="token punctuation">;</span> y <span class="token operator">&lt;-</span> new_y <span class="token keyword">end</span>
      <span class="token keyword">method</span> <span class="token keyword">private</span> print_x <span class="token operator">=</span> print_int x <span class="token comment">(* 私有方法 *)</span>

      <span class="token comment">(* 构造函数 *)</span>
      <span class="token keyword">initializer</span> <span class="token keyword">begin</span>
        x <span class="token operator">&lt;-</span> ini_x<span class="token punctuation">;</span> y <span class="token operator">&lt;-</span> ini_y
      <span class="token keyword">end</span>
    <span class="token keyword">end</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token comment">(* 签名 *)</span>    
<span class="token keyword">class</span> point <span class="token punctuation">:</span>
  int <span class="token operator">-></span>
  int <span class="token operator">-></span>
  <span class="token keyword">object</span>
    <span class="token keyword">val</span> <span class="token keyword">mutable</span> x <span class="token punctuation">:</span> int
    <span class="token keyword">val</span> <span class="token keyword">mutable</span> y <span class="token punctuation">:</span> int
    <span class="token keyword">method</span> <span class="token keyword">private</span> print_x <span class="token punctuation">:</span> unit
    <span class="token keyword">method</span> set <span class="token punctuation">:</span> int <span class="token operator">-></span> int <span class="token operator">-></span> unit
  <span class="token keyword">end</span>
</code></pre>
            <h4>实例生成</h4>
            <p>new 类名称</p>
            <pre><code class="language-ocaml"># <span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> point<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">val</span> p <span class="token punctuation">:</span> point <span class="token operator">=</span> <span class="token operator">&lt;</span>obj<span class="token operator">></span>
</code></pre>
            <h4>调用实例方法</h4>
            <p>实例#方法名称</p>
            <pre><code class="language-ocaml"># p#set <span class="token number">1</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">:</span> unit <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
            <h4>継承</h4>
            <p>inherit 类名</p>
            <p>以下类可以由 self 本身通过 super 访问父类。</p>
            <pre><code class="language-ocaml"><span class="token comment">(* 打印坐标 *)</span>
# <span class="token keyword">class</span> point_with_print x y <span class="token operator">=</span>
    <span class="token keyword">object</span> <span class="token punctuation">(</span>self<span class="token punctuation">)</span>
      <span class="token keyword">inherit</span> point x y <span class="token keyword">as</span> super <span class="token comment">(* 访问父类的名称 *)</span>
      <span class="token keyword">method</span> print <span class="token operator">=</span> <span class="token module variable">Printf</span><span class="token punctuation">.</span>printf <span class="token string">"(%d, %d)\n"</span> x y
    <span class="token keyword">end</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> point_with_print <span class="token punctuation">:</span>
  int <span class="token operator">-></span>
  int <span class="token operator">-></span>
  <span class="token keyword">object</span>
    <span class="token keyword">val</span> <span class="token keyword">mutable</span> x <span class="token punctuation">:</span> int
    <span class="token keyword">val</span> <span class="token keyword">mutable</span> y <span class="token punctuation">:</span> int
    <span class="token keyword">method</span> print <span class="token punctuation">:</span> unit
    <span class="token keyword">method</span> <span class="token keyword">private</span> print_x <span class="token punctuation">:</span> unit
    <span class="token keyword">method</span> set <span class="token punctuation">:</span> int <span class="token operator">-></span> int <span class="token operator">-></span> unit
  <span class="token keyword">end</span>

<span class="token comment">(* 生成继承类的实例 *)</span>
# <span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> point_with_print <span class="token number">1</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">val</span> p <span class="token punctuation">:</span> point_with_print <span class="token operator">=</span> <span class="token operator">&lt;</span>obj<span class="token operator">></span>
# p#print<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token operator">-</span> <span class="token punctuation">:</span> unit <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
            <h4>类类型</h4>
            <h5>&lt;方法名称：类型 …&gt;</h5>
            <ul>
              <li>对象的类型是方法类型的顺序</li>
              <li>如果方法名称和类型的组合匹配，则认为是相同的对象类型</li>
              <li>要检查一个类的类型，直接使用 let 定义对象而不使用 class。</li>
            </ul>
            <pre><code class="language-ocaml"><span class="token comment">(* 直接定义对象 *)</span>
<span class="token keyword">let</span> obj <span class="token operator">=</span> 
  <span class="token keyword">object</span> <span class="token punctuation">(</span>self<span class="token punctuation">)</span>
    <span class="token keyword">val</span> <span class="token keyword">mutable</span> x <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">val</span> <span class="token keyword">mutable</span> y <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">method</span> set new_x new_y <span class="token operator">=</span> <span class="token keyword">begin</span> x <span class="token operator">&lt;-</span> new_x<span class="token punctuation">;</span> y <span class="token operator">&lt;-</span> new_y <span class="token keyword">end</span>
  <span class="token keyword">end</span><span class="token punctuation">;</span><span class="token punctuation">;</span>

<span class="token comment">(* 显示类型 *)</span>
<span class="token keyword">val</span> obj <span class="token punctuation">:</span> <span class="token operator">&lt;</span> set <span class="token punctuation">:</span> int <span class="token operator">-></span> int <span class="token operator">-></span> unit <span class="token operator">></span> <span class="token operator">=</span> <span class="token operator">&lt;</span>obj<span class="token operator">></span>
<span class="token comment">(* 尝试调用实例方法 *)</span>
# obj#set <span class="token number">1</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">:</span> unit <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
            <h4>上面的 obj 类型是 &lt; set : int -&gt; int -&gt; unit &gt;</h4>
            <p>换句话说，这意味着有一个方法设置int - &gt; int - &gt; unit。</p>
            <p>具有满足这个定义的方法的类被认为是相同的对象类型。</p>
            <pre><code class="language-ocaml"><span class="token comment">(* 定义上面与obj无关的类 *)</span>
# <span class="token keyword">class</span> unrelated_class <span class="token operator">=</span>
    <span class="token keyword">object</span>
      <span class="token comment">(* 定义一个显示x，y的方法集 *)</span>
      <span class="token keyword">method</span> set x y <span class="token operator">=</span> <span class="token module variable">Printf</span><span class="token punctuation">.</span>printf <span class="token string">"(%d, %d)\n"</span> x y
    <span class="token keyword">end</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> unrelated_class <span class="token punctuation">:</span> <span class="token keyword">object</span> <span class="token keyword">method</span> set <span class="token punctuation">:</span> int <span class="token operator">-></span> int <span class="token operator">-></span> unit <span class="token keyword">end</span>

<span class="token comment">(* 由于对象类型匹配，它们被放在同一个列表中 *)</span>
# <span class="token keyword">let</span> obj2 <span class="token operator">=</span> <span class="token keyword">new</span> unrelated_class<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">val</span> obj2 <span class="token punctuation">:</span> unrelated_class <span class="token operator">=</span> <span class="token operator">&lt;</span>obj<span class="token operator">></span>
# <span class="token punctuation">[</span>obj<span class="token punctuation">;</span> obj2<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">:</span> unrelated_class list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">&lt;</span>obj<span class="token operator">></span><span class="token punctuation">;</span> <span class="token operator">&lt;</span>obj<span class="token operator">></span><span class="token punctuation">]</span>

<span class="token comment">(* 由于对象类型匹配，可以将其作为相同的返回值类型进行处理 *)</span>
# <span class="token keyword">let</span> hoge x <span class="token operator">=</span> <span class="token keyword">if</span> x <span class="token keyword">then</span> obj <span class="token keyword">else</span> <span class="token keyword">new</span> unrelated_class<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">val</span> hoge <span class="token punctuation">:</span> bool <span class="token operator">-></span> unrelated_class <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token keyword">fun</span><span class="token operator">></span>
# <span class="token punctuation">(</span>hoge <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token directive important">#set</span> <span class="token number">1</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">:</span> unit <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
# <span class="token punctuation">(</span>hoge <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token directive important">#set</span> <span class="token number">1</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token operator">-</span> <span class="token punctuation">:</span> unit <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
            <p>我个人觉得Java和Go的界面正在扮演OCaml的对象类型的角色。</p>
            <h4>部分类型</h4>
            <h5>部分类型=&gt;如果定义了部分对象类型的方法，则将其视为部分类型</h5>
            <ul>
              <li>示例：类型2是类型1的部分类型</li>
              <li>类型1 =&gt; &lt;方法1：int - &gt; int，方法2：unit&gt;</li>
              <li>类型2 =&gt; &lt;method1：int - &gt; int&gt;</li>
            </ul>
            <h4>CORATION（类型转换）</h4>
            <p>（表达式：类型1：&gt;类型2）</p>
            <p>将部分类型1转换为类型2。 它接近于Java中的上传。</p>
            <pre><code class="language-ocaml"><span class="token comment">(* print_class1 是 print_class2 的部分类型 *)</span>
# <span class="token keyword">class</span> print_class1 <span class="token operator">=</span> <span class="token keyword">object</span>
    <span class="token keyword">method</span> print_1 <span class="token operator">=</span> print_int <span class="token number">1</span>
  <span class="token keyword">end</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> print_class1 <span class="token punctuation">:</span> <span class="token keyword">object</span> <span class="token keyword">method</span> print_1 <span class="token punctuation">:</span> unit <span class="token keyword">end</span>
# <span class="token keyword">class</span> print_class2 <span class="token operator">=</span> <span class="token keyword">object</span>
    <span class="token keyword">method</span> print_1 <span class="token operator">=</span> print_int <span class="token number">1</span>
    <span class="token keyword">method</span> print_2 <span class="token operator">=</span> print_int <span class="token number">2</span>
  <span class="token keyword">end</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> print_class2 <span class="token punctuation">:</span> <span class="token keyword">object</span> <span class="token keyword">method</span> print_1 <span class="token punctuation">:</span> unit <span class="token keyword">method</span> print_2 <span class="token punctuation">:</span> unit <span class="token keyword">end</span>

<span class="token comment">(* 由于对象类型不同，print_class 1和print_class 2不在同一个列表中 *)</span>
# <span class="token keyword">let</span> obj_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">new</span> print_class1<span class="token punctuation">;</span> <span class="token keyword">new</span> print_class2<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token module variable">Error</span><span class="token punctuation">:</span> <span class="token module variable">This</span> expression has <span class="token keyword">type</span> print_class2
       but an expression was expected <span class="token keyword">of</span> <span class="token keyword">type</span> print_class1
       <span class="token module variable">The</span> second <span class="token keyword">object</span> <span class="token keyword">type</span> has no <span class="token keyword">method</span> print_2

<span class="token comment">(* 通过指导（类型转换）把它们放在同一个列表中 *)</span>
# <span class="token keyword">let</span> obj_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">new</span> print_class1<span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token keyword">new</span> print_class2 <span class="token punctuation">:</span><span class="token operator">></span> print_class1<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">val</span> obj_list <span class="token punctuation">:</span> print_class1 list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">&lt;</span>obj<span class="token operator">></span><span class="token punctuation">;</span> <span class="token operator">&lt;</span>obj<span class="token operator">></span><span class="token punctuation">]</span>

<span class="token comment">(* コアーションによって削ぎ落とされた情報は呼び出せない *)</span>
# <span class="token keyword">let</span> <span class="token punctuation">[</span>obj1<span class="token punctuation">;</span> obj2<span class="token punctuation">]</span> <span class="token operator">=</span> obj_list<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">val</span> obj1 <span class="token punctuation">:</span> print_class1 <span class="token operator">=</span> <span class="token operator">&lt;</span>obj<span class="token operator">></span>
<span class="token keyword">val</span> obj2 <span class="token punctuation">:</span> print_class1 <span class="token operator">=</span> <span class="token operator">&lt;</span>obj<span class="token operator">></span>

# obj1#print_1<span class="token punctuation">;</span><span class="token punctuation">;</span> <span class="token comment">(* 可以调用 *)</span>
<span class="token number">1</span><span class="token operator">-</span> <span class="token punctuation">:</span> unit <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
# obj2#print_2<span class="token punctuation">;</span><span class="token punctuation">;</span> <span class="token comment">(* 不能被调用 *)</span>
<span class="token module variable">Error</span><span class="token punctuation">:</span> <span class="token module variable">This</span> expression has <span class="token keyword">type</span> print_class1
       <span class="token module variable">It</span> has no <span class="token keyword">method</span> print_2
</code></pre>
            <h4>多层对象类型</h4>
            <p>表示满足部分类型的任意类型</p>
            <ul>
              <li>&lt;方法名称1：类型1; …，方法名称n：类型n; …&gt;</li>
              <li>最后一个“…”是重要的</li>
              <li>换句话说，它表示“各种其他”</li>
            </ul>
            <pre><code class="language-ocaml">
<span class="token comment">(* 定义接受多层对象类型的函数 *)</span>
# <span class="token keyword">let</span> print1 print_obj <span class="token operator">=</span> print_obj#print_1<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">val</span> print1 <span class="token punctuation">:</span> <span class="token operator">&lt;</span> print_1 <span class="token punctuation">:</span> <span class="token type_variable function">'a</span><span class="token punctuation">;</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token operator">></span> <span class="token operator">-></span> <span class="token type_variable function">'a</span> <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token keyword">fun</span><span class="token operator">></span>

<span class="token comment">(* 您可以接收满足部分类型的对象类型 *)</span>
# print1 obj1<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token number">1</span><span class="token operator">-</span> <span class="token punctuation">:</span> unit <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
# print1 obj2<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token number">1</span><span class="token operator">-</span> <span class="token punctuation">:</span> unit <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
            <p>以上 &lt; print_1 : 'a; … &gt; -&gt; 'a = <fun> 中的 -&gt; 'a 部分 'a 是一个类型变量 &lt; print_1 : 'a; … &gt; 的别名</p>
            <h4>关于多层次对象类型的参数类型的变化</h4>
            <p>如果你给一个多层次的类型的参数</p>
            <pre><code class="language-ocaml"><span class="token comment">(* 定义多层函数 *)</span>
# <span class="token keyword">let</span> k1 a b <span class="token operator">=</span> a <span class="token operator">and</span> k2 a b <span class="token operator">=</span> b<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">val</span> k1 <span class="token punctuation">:</span> <span class="token type_variable function">'a</span> <span class="token operator">-></span> <span class="token type_variable function">'b</span> <span class="token operator">-></span> <span class="token type_variable function">'a</span> <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token keyword">fun</span><span class="token operator">></span>
<span class="token keyword">val</span> k2 <span class="token punctuation">:</span> <span class="token type_variable function">'a</span> <span class="token operator">-></span> <span class="token type_variable function">'b</span> <span class="token operator">-></span> <span class="token type_variable function">'b</span> <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token keyword">fun</span><span class="token operator">></span>

<span class="token comment">(* 请求相同类型的函数的返回值会更改该类型。 *)</span>
# <span class="token keyword">let</span> f b <span class="token operator">=</span> <span class="token keyword">if</span> b <span class="token keyword">then</span> k1 <span class="token keyword">else</span> k2<span class="token punctuation">;</span><span class="token punctuation">;</span>
（<span class="token operator">*</span><span class="token type_variable function">'a</span> <span class="token operator">-</span> <span class="token operator">></span><span class="token type_variable function">'b</span> <span class="token operator">-</span> <span class="token operator">></span><span class="token type_variable function">'a</span> <span class="token operator">/</span><span class="token type_variable function">'b</span> 的类型是 <span class="token type_variable function">'a</span> <span class="token operator">-</span> <span class="token operator">></span><span class="token type_variable function">'a</span> <span class="token operator">-</span> <span class="token operator">></span><span class="token type_variable function">'a</span> <span class="token operator">*</span>）
<span class="token keyword">val</span> f <span class="token punctuation">:</span> bool <span class="token operator">-></span> <span class="token type_variable function">'a</span> <span class="token operator">-></span> <span class="token type_variable function">'a</span> <span class="token operator">-></span> <span class="token type_variable function">'a</span> <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token keyword">fun</span><span class="token operator">></span>
</code></pre>
            <p>当给出一个不是多层的类型的参数时</p>
            <pre><code class="language-ocaml"><span class="token comment">(* 不同类型的函数 *)</span>
# <span class="token keyword">let</span> k1' <span class="token punctuation">(</span>a<span class="token punctuation">:</span>int<span class="token punctuation">)</span> <span class="token punctuation">(</span>b<span class="token punctuation">:</span>string<span class="token punctuation">)</span> <span class="token operator">=</span> a <span class="token operator">and</span> k2' <span class="token punctuation">(</span>a<span class="token punctuation">:</span>int<span class="token punctuation">)</span> <span class="token punctuation">(</span>b<span class="token punctuation">:</span>string<span class="token punctuation">)</span> <span class="token operator">=</span> b<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">val</span> k1' <span class="token punctuation">:</span> int <span class="token operator">-></span> string <span class="token operator">-></span> int <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token keyword">fun</span><span class="token operator">></span>
<span class="token keyword">val</span> k2' <span class="token punctuation">:</span> int <span class="token operator">-></span> string <span class="token operator">-></span> string <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token keyword">fun</span><span class="token operator">></span>

（<span class="token operator">*</span>
  <span class="token operator">*</span>由于返回值的函数类型不同，因此不能作为返回值使用
  <span class="token operator">*</span>统一的类型不能完成
 <span class="token operator">*</span>）
# <span class="token keyword">let</span> f' b <span class="token operator">=</span> <span class="token keyword">if</span> b <span class="token keyword">then</span> k1' <span class="token keyword">else</span> k2'<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token module variable">Error</span><span class="token punctuation">:</span> <span class="token module variable">This</span> expression has <span class="token keyword">type</span> int <span class="token operator">-></span> string <span class="token operator">-></span> string
       but an expression was expected <span class="token keyword">of</span> <span class="token keyword">type</span> int <span class="token operator">-></span> string <span class="token operator">-></span> int
       <span class="token module variable">Type</span> string is not compatible <span class="token keyword">with</span> <span class="token keyword">type</span> int
</code></pre>
            <p>给定一个多层对象类型</p>
            <pre><code class="language-ocaml"><span class="token comment">(* 多定义分层对象类型的函数 *)</span>
# <span class="token keyword">let</span> print1' obj <span class="token operator">=</span> obj#print_1 <span class="token operator">and</span> print2' obj <span class="token operator">=</span> obj#print_2<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">val</span> print1' <span class="token punctuation">:</span> <span class="token operator">&lt;</span> print_1 <span class="token punctuation">:</span> <span class="token type_variable function">'a</span><span class="token punctuation">;</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token operator">></span> <span class="token operator">-></span> <span class="token type_variable function">'a</span> <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token keyword">fun</span><span class="token operator">></span>
<span class="token keyword">val</span> print2' <span class="token punctuation">:</span> <span class="token operator">&lt;</span> print_2 <span class="token punctuation">:</span> <span class="token type_variable function">'a</span><span class="token punctuation">;</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token operator">></span> <span class="token operator">-></span> <span class="token type_variable function">'a</span> <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token keyword">fun</span><span class="token operator">></span>

<span class="token comment">(* 当组合两个分层对象类型函数时 *)</span>
# <span class="token keyword">let</span> f b <span class="token operator">=</span> <span class="token keyword">if</span> b <span class="token keyword">then</span> print1' <span class="token keyword">else</span> print2'<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token comment">(*
 * 函数的返回值的类型为 &lt; print_1 : 'a; print_2 : 'a; .. >
 * 换句话说，诸如合成每个多层对象类型的类型变成了
 *)</span>
<span class="token keyword">val</span> f <span class="token punctuation">:</span> bool <span class="token operator">-></span> <span class="token operator">&lt;</span> print_1 <span class="token punctuation">:</span> <span class="token type_variable function">'a</span><span class="token punctuation">;</span> print_2 <span class="token punctuation">:</span> <span class="token type_variable function">'a</span><span class="token punctuation">;</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token operator">></span> <span class="token operator">-></span> <span class="token type_variable function">'a</span> <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token keyword">fun</span><span class="token operator">></span>

<span class="token comment">(* 函数调用 *)</span>
# <span class="token keyword">let</span> a <span class="token operator">=</span> f <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">val</span> a <span class="token punctuation">:</span> <span class="token operator">&lt;</span> print_1 <span class="token punctuation">:</span> <span class="token type_variable function">'_a</span><span class="token punctuation">;</span> print_2 <span class="token punctuation">:</span> <span class="token type_variable function">'_a</span><span class="token punctuation">;</span> <span class="token punctuation">_</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token operator">></span> <span class="token operator">-></span> <span class="token type_variable function">'_a</span> <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token keyword">fun</span><span class="token operator">></span>
<span class="token comment">(* print_2 因为它没有类型错误 *)</span>
# a <span class="token keyword">new</span> print_class1<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token module variable">Error</span><span class="token punctuation">:</span> <span class="token module variable">This</span> expression has <span class="token keyword">type</span> print_class1
       but an expression was expected <span class="token keyword">of</span> <span class="token keyword">type</span> print_class2
       <span class="token module variable">The</span> first <span class="token keyword">object</span> <span class="token keyword">type</span> has no <span class="token keyword">method</span> print_2
<span class="token comment">(* OK, 因为它满足对象类型 *)</span>
# a <span class="token keyword">new</span> print_class2<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token number">1</span><span class="token operator">-</span> <span class="token punctuation">:</span> unit <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
            <h4>抽象方法·抽象类</h4>
            <ul>
              <li>定义假定稍后继承</li>
              <li>抽象方法=&gt;具有空定义的方法</li>
              <li>method virtual 方法 : 类型</li>
              <li>抽象类=&gt;抽象方法的类定义</li>
            </ul>
            <pre><code class="language-ocaml">
<span class="token comment">(* 抽象类的定义 *)</span>
# <span class="token keyword">class</span> <span class="token keyword">virtual</span> abstruct_print <span class="token operator">=</span>
    <span class="token keyword">object</span> <span class="token punctuation">(</span>self<span class="token punctuation">)</span>
      <span class="token keyword">method</span> <span class="token keyword">virtual</span> print <span class="token punctuation">:</span> unit <span class="token comment">(* 抽象方法 *)</span>
    <span class="token keyword">end</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token keyword">virtual</span> abstruct_print <span class="token punctuation">:</span> <span class="token keyword">object</span> <span class="token keyword">method</span> <span class="token keyword">virtual</span> print <span class="token punctuation">:</span> unit <span class="token keyword">end</span>

<span class="token comment">(* 继承抽象类 *)</span>
# <span class="token keyword">class</span> print_hoge <span class="token operator">=</span>
    <span class="token keyword">object</span> <span class="token punctuation">(</span>self<span class="token punctuation">)</span>
      <span class="token keyword">inherit</span> abstruct_print
      <span class="token keyword">method</span> print <span class="token operator">=</span> <span class="token module variable">Printf</span><span class="token punctuation">.</span>printf <span class="token string">"hoge!\n"</span>
    <span class="token keyword">end</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> print_hoge <span class="token punctuation">:</span> <span class="token keyword">object</span> <span class="token keyword">method</span> print <span class="token punctuation">:</span> unit <span class="token keyword">end</span>
</code></pre>
            <p>class virtual</p>
            <h4>多阶段类（泛型）</h4>
            <ul>
              <li>定义用类型参数化的对象类。</li>
              <li>类定义=&gt;定义一个同名的对象类型，而不仅仅是类</li>
              <li>类型变量的声明是定义多层定义中的类类型所必需的</li>
              <li>显式声明类型变量</li>
              <li>请参阅中定义的类型变量</li>
            </ul>
            <h4>class [类型变量, …] 类名称 object … end</h4>
            <p>定义一个可以填充任何类型值的堆栈（从官方网站引用）</p>
            <pre><code class="language-ocaml"># <span class="token keyword">class</span> <span class="token punctuation">[</span><span class="token type_variable function">'a</span><span class="token punctuation">]</span> stack <span class="token operator">=</span>
    <span class="token keyword">object</span> <span class="token punctuation">(</span>self<span class="token punctuation">)</span>
      <span class="token keyword">val</span> <span class="token keyword">mutable</span> list <span class="token operator">=</span> <span class="token punctuation">(</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token type_variable function">'a</span> list <span class="token punctuation">)</span>  <span class="token comment">(* 实例变量 *)</span>
      <span class="token keyword">method</span> push x <span class="token operator">=</span> list <span class="token operator">&lt;-</span> x <span class="token punctuation">:</span><span class="token punctuation">:</span> list    <span class="token comment">(* 推入堆栈 *)</span>
      <span class="token keyword">method</span> pop <span class="token operator">=</span>                         <span class="token comment">(* 从堆栈中移除(pop) *)</span>
        <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token module variable">List</span><span class="token punctuation">.</span>hd list <span class="token keyword">in</span>
        list <span class="token operator">&lt;-</span> <span class="token module variable">List</span><span class="token punctuation">.</span>tl list<span class="token punctuation">;</span>
        result
      <span class="token keyword">method</span> peek <span class="token operator">=</span> <span class="token module variable">List</span><span class="token punctuation">.</span>hd list     <span class="token comment">(* 堆栈峰值 *)</span>
      <span class="token keyword">method</span> size <span class="token operator">=</span> <span class="token module variable">List</span><span class="token punctuation">.</span>length list <span class="token comment">(* 堆栈的大小 *)</span>
    <span class="token keyword">end</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token punctuation">[</span><span class="token type_variable function">'a</span><span class="token punctuation">]</span> stack <span class="token punctuation">:</span>
  <span class="token keyword">object</span>
    <span class="token keyword">val</span> <span class="token keyword">mutable</span> list <span class="token punctuation">:</span> <span class="token type_variable function">'a</span> list
    <span class="token keyword">method</span> peek <span class="token punctuation">:</span> <span class="token type_variable function">'a</span>
    <span class="token keyword">method</span> pop <span class="token punctuation">:</span> <span class="token type_variable function">'a</span>
    <span class="token keyword">method</span> push <span class="token punctuation">:</span> <span class="token type_variable function">'a</span> <span class="token operator">-></span> unit
    <span class="token keyword">method</span> size <span class="token punctuation">:</span> int
  <span class="token keyword">end</span>
</code></pre>
            <p>使用多阶段类</p>
            <pre><code class="language-ocaml"><span class="token comment">(* 生成堆栈的一个实例 *)</span>
# <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token keyword">new</span> stack<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token comment">(* 用非约束状态的类型变量生成实例 *)</span>
<span class="token keyword">val</span> s <span class="token punctuation">:</span> <span class="token type_variable function">'_a</span> stack <span class="token operator">=</span> <span class="token operator">&lt;</span>obj<span class="token operator">></span>
<span class="token comment">(* 添加一个浮点数 *)</span>
# s#push <span class="token number">1.0</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">:</span> unit <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">(* 类型变量 '_a 被绑定为浮点数 *)</span>
# s<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">:</span> float stack <span class="token operator">=</span> <span class="token operator">&lt;</span>obj<span class="token operator">></span>
</code></pre>

          </div>
        </div>
      </div>
    </div>
  </body>

</html>