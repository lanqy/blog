<!--
 * @Author: Leland
 * @Date: 2019-12-27 15:59:00
 * @Description: Description
 -->
<!doctype html>
<html>

  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui" />
    <title>OCaml简介第6部分</title>
    <link href="/css/style.css" rel="stylesheet" />
    <meta name="description" content="OCaml简介第6部分">
  </head>

  <body>
    <div>
      <div>
        <header class="header">
          <div class="container header-wrap">
            <h1 class="site-name">
              <a href="/">
                首页
              </a>
            </h1>
            <ul class="nav">
              <li class="nav-item">
                <a href="/about">关于</a>
              </li>
            </ul>
          </div>
        </header>
      </div>
      <div class="container main">
        <div class="page-body">
          <div class="markdown-body">
            <h2>OCaml简介第6部分</h2>
            <p>译自：<a href="https://qiita.com/zenwerk/items/97d370d457008d8f01de">https://qiita.com/zenwerk/items/97d370d457008d8f01de</a></p>
            <h3>标记的参数</h3>
            <h4>〜标签名称：</h4>
            <ul>
              <li>你可以命名这个参数。</li>
              <li>如果你给一个标签名称，你可以改变你喜欢的参数的顺序。</li>
            </ul>
            <pre><code class="language-ocaml"><span class="token comment">(* 使用带标签的参数定义函数 *)</span>

# <span class="token keyword">let</span> <span class="token keyword">rec</span> range <span class="token label function">~first</span><span class="token punctuation">:</span> a  <span class="token label function">~last</span><span class="token punctuation">:</span> b <span class="token operator">=</span> 
  <span class="token keyword">if</span> a <span class="token operator">></span> b <span class="token keyword">then</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">else</span> a <span class="token punctuation">:</span><span class="token punctuation">:</span> range <span class="token label function">~first</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>a <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token label function">~last</span><span class="token punctuation">:</span> b<span class="token punctuation">;</span><span class="token punctuation">;</span>
  
<span class="token comment">(* 函数类型上的标签类型 *)</span>
<span class="token keyword">val</span> range <span class="token punctuation">:</span> first<span class="token punctuation">:</span>int <span class="token operator">-></span> last<span class="token punctuation">:</span>int <span class="token operator">-></span> int list <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token keyword">fun</span><span class="token operator">></span>

<span class="token comment">(* 指定标签名称函数应用程序 *)</span>

# range <span class="token label function">~first</span><span class="token punctuation">:</span> <span class="token number">1</span> <span class="token label function">~last</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">;</span><span class="token punctuation">;</span>

<span class="token operator">-</span> <span class="token punctuation">:</span> int list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token number">6</span><span class="token punctuation">;</span> <span class="token number">7</span><span class="token punctuation">;</span> <span class="token number">8</span><span class="token punctuation">;</span> <span class="token number">9</span><span class="token punctuation">;</span> <span class="token number">10</span><span class="token punctuation">]</span> 

# range <span class="token label function">~last</span><span class="token punctuation">:</span> <span class="token number">10</span> <span class="token label function">~first</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">;</span>

<span class="token operator">-</span> <span class="token punctuation">:</span> int list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token number">6</span><span class="token punctuation">;</span> <span class="token number">7</span><span class="token punctuation">;</span> <span class="token number">8</span><span class="token punctuation">;</span> <span class="token number">9</span><span class="token punctuation">;</span> <span class="token number">10</span><span class="token punctuation">]</span> 

<span class="token comment">(* 除非指定了标签名称，否则按标签名称定义应用 *)</span> 

# range <span class="token number">1</span> <span class="token number">10</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">:</span> int list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token number">6</span><span class="token punctuation">;</span> <span class="token number">7</span><span class="token punctuation">;</span> <span class="token number">8</span><span class="token punctuation">;</span> <span class="token number">9</span><span class="token punctuation">;</span> <span class="token number">10</span><span class="token punctuation">]</span>

# range <span class="token number">10</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">:</span> int list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
</code></pre>
            <ul>
              <li>〜hoge：○○ ○○ 是可选的</li>
            </ul>
            <pre><code class="language-ocaml"># <span class="token keyword">let</span> <span class="token keyword">rec</span> range <span class="token label function">~first</span> <span class="token label function">~last</span> <span class="token operator">=</span> 
  <span class="token keyword">if</span> first <span class="token operator">></span> last <span class="token keyword">then</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">else</span> first <span class="token punctuation">:</span><span class="token punctuation">:</span> range <span class="token punctuation">(</span>first <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> last<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">val</span> range <span class="token punctuation">:</span> first<span class="token punctuation">:</span>int <span class="token operator">-></span> last<span class="token punctuation">:</span>int <span class="token operator">-></span> int list <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token keyword">fun</span><span class="token operator">></span>
</code></pre>
            <h4>可选参数</h4>
            <p>?标签名称：（pattern =表达式）</p>
            <p>与Python的家伙相同的功能。</p>
            <pre><code class="language-ocaml"><span class="token comment">(* 默认值1给出步骤值 *)</span>

# <span class="token keyword">let</span> <span class="token keyword">rec</span> range <span class="token operator">?</span><span class="token punctuation">(</span>step <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> a b <span class="token operator">=</span> 
  <span class="token keyword">if</span> a <span class="token operator">></span> b <span class="token keyword">then</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">else</span> a <span class="token punctuation">:</span><span class="token punctuation">:</span> range <span class="token label function">~step</span> <span class="token punctuation">(</span>a <span class="token operator">+</span> step<span class="token punctuation">)</span> b<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">val</span> range <span class="token punctuation">:</span> <span class="token operator">?</span>step<span class="token punctuation">:</span>int <span class="token operator">-></span> int <span class="token operator">-></span> int <span class="token operator">-></span> int list <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token keyword">fun</span><span class="token operator">></span>

<span class="token comment">(* 函数应用 *)</span>
# range <span class="token number">1</span> <span class="token number">10</span><span class="token punctuation">;</span><span class="token punctuation">;</span>

<span class="token operator">-</span> <span class="token punctuation">:</span> int list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token number">6</span><span class="token punctuation">;</span> <span class="token number">7</span><span class="token punctuation">;</span> <span class="token number">8</span><span class="token punctuation">;</span> <span class="token number">9</span><span class="token punctuation">;</span> <span class="token number">10</span><span class="token punctuation">]</span>

<span class="token comment">(* 因为它在调用时指定了标签 *)</span>

# range <span class="token number">1</span> <span class="token number">10</span> <span class="token label function">~step</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">:</span> int list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token number">7</span><span class="token punctuation">;</span> <span class="token number">9</span><span class="token punctuation">]</span>
# range <span class="token number">1</span> <span class="token label function">~step</span><span class="token punctuation">:</span><span class="token number">3</span> <span class="token number">10</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">:</span> int list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token number">7</span><span class="token punctuation">;</span> <span class="token number">10</span><span class="token punctuation">]</span>

# range <span class="token number">2</span> <span class="token number">1</span> <span class="token number">10</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token module variable">Error</span><span class="token punctuation">:</span> <span class="token module variable">The</span> <span class="token keyword">function</span> applied <span class="token keyword">to</span> this argument has <span class="token keyword">type</span> <span class="token operator">?</span>step<span class="token punctuation">:</span>int <span class="token operator">-></span> int list
<span class="token module variable">This</span> argument cannot be applied without label
</code></pre>
            <h4>关于可选参数的说明</h4>
            <h5>在选项参数后面准备一个无标签的参数</h5>
            <p>如果选项参数在函数的结尾，则它变成了不能省略的选项参数，所以没有任何意义。</p>
            <pre><code class="language-ocaml"><span class="token comment">(**
 * 我想定义一个函数，返回常量1 ....。
 * 如果选项参数在最后，我会收到警告
 *)</span>
# <span class="token keyword">let</span> f <span class="token operator">?</span><span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> x<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token module variable">Warning</span> <span class="token number">16</span><span class="token punctuation">:</span> this optional argument cannot be erased<span class="token punctuation">.</span>
<span class="token keyword">val</span> f <span class="token punctuation">:</span> <span class="token operator">?</span>x<span class="token punctuation">:</span>int <span class="token operator">-></span> int <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token keyword">fun</span><span class="token operator">></span>
<span class="token comment">(* 1函数返回我以为它返回一个函数，接收*选项参数返回正在currying
 *)</span>
# f<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">:</span> <span class="token operator">?</span>x<span class="token punctuation">:</span>int <span class="token operator">-></span> int <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token keyword">fun</span><span class="token operator">></span>

<span class="token comment">(* 最后这么糟糕，不要添加无标签的参数 *)</span>
# <span class="token keyword">let</span> f <span class="token operator">?</span><span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> x<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">val</span> f <span class="token punctuation">:</span> <span class="token operator">?</span>x<span class="token punctuation">:</span>int <span class="token operator">-></span> unit <span class="token operator">-></span> int <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token keyword">fun</span><span class="token operator">></span>
# f<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">:</span> <span class="token operator">?</span>x<span class="token punctuation">:</span>int <span class="token operator">-></span> unit <span class="token operator">-></span> int <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token keyword">fun</span><span class="token operator">></span>
# f<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">:</span> int <span class="token operator">=</span> <span class="token number">1</span>
</code></pre>
            <h4>选项参数实体</h4>
            <p>可选参数是用 'a option 实现的</p>
            <p>如果你没有指定默认值，并写入它，尝试执行，你会得到一个错误，如下所示</p>
            <pre><code class="language-ocaml"># <span class="token keyword">let</span> <span class="token keyword">rec</span> range <span class="token operator">?</span>step a b <span class="token operator">=</span>
    <span class="token keyword">if</span> a <span class="token operator">></span> b <span class="token keyword">then</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">else</span> a <span class="token punctuation">:</span><span class="token punctuation">:</span> range <span class="token label function">~step</span> <span class="token punctuation">(</span>a<span class="token operator">+</span>step<span class="token punctuation">)</span> b<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token comment">(* 'a option type error is occurring  *)</span>
<span class="token module variable">Error</span><span class="token punctuation">:</span> <span class="token module variable">This</span> expression has <span class="token keyword">type</span> <span class="token type_variable function">'a</span> option
       but an expression was expected <span class="token keyword">of</span> <span class="token keyword">type</span> <span class="token type_variable function">'a</span>
       <span class="token module variable">The</span> <span class="token keyword">type</span> variable <span class="token type_variable function">'a</span> occurs inside <span class="token type_variable function">'a</span> option
</code></pre>
            <p>因此，在这种情况下，None 加 'a Some 来模式匹配</p>
            <pre><code class="language-ocaml">
<span class="token comment">(* 与选项类型匹配的模式 *)</span>

# <span class="token keyword">let</span> <span class="token keyword">rec</span> range <span class="token operator">?</span>step a b <span class="token operator">=</span>
    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token keyword">match</span> step <span class="token keyword">with</span> <span class="token module variable">None</span> <span class="token operator">-></span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token module variable">Some</span> s <span class="token operator">-></span> s <span class="token keyword">in</span>
    <span class="token keyword">if</span> a <span class="token operator">></span> b <span class="token keyword">then</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">else</span> a <span class="token punctuation">:</span><span class="token punctuation">:</span> range <span class="token punctuation">(</span>a <span class="token operator">+</span> s<span class="token punctuation">)</span> b<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">val</span> range <span class="token punctuation">:</span> <span class="token operator">?</span>step<span class="token punctuation">:</span>int <span class="token operator">-></span> int <span class="token operator">-></span> int <span class="token operator">-></span> int list <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token keyword">fun</span><span class="token operator">></span>

# range <span class="token number">1</span> <span class="token number">10</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">:</span> int list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token number">6</span><span class="token punctuation">;</span> <span class="token number">7</span><span class="token punctuation">;</span> <span class="token number">8</span><span class="token punctuation">;</span> <span class="token number">9</span><span class="token punctuation">;</span> <span class="token number">10</span><span class="token punctuation">]</span>
</code></pre>
            <h4>多态变种</h4>
            <h5>`Constructor</h5>
            <p>一种机制，可以为多种变体类型使用通用的构造函数。</p>
            <p>消除 “1构造函数&lt;=&gt; 1变体” 的限制。</p>
            <pre><code class="language-ocaml"># <span class="token variant variable">`Hoge</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token operator">></span> <span class="token variant variable">`Hoge</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variant variable">`Hoge</span>
# <span class="token variant variable">`Hoge</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token operator">></span> <span class="token variant variable">`Hoge</span> <span class="token keyword">of</span> int <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variant variable">`Hoge</span> <span class="token number">2</span>
# <span class="token variant variable">`Hoge</span> <span class="token variant variable">`Fuga</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token operator">></span> <span class="token variant variable">`Hoge</span> <span class="token keyword">of</span> <span class="token punctuation">[</span><span class="token operator">></span> <span class="token variant variable">`Fuga</span> <span class="token punctuation">]</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variant variable">`Hoge</span> <span class="token variant variable">`Fuga</span>
</code></pre>
            <h4>函数返回多态变种</h4>
            <pre><code class="language-ocaml"># <span class="token keyword">let</span> f b <span class="token operator">=</span> <span class="token keyword">if</span> b <span class="token keyword">then</span> <span class="token variant variable">`Hoge</span> <span class="token keyword">else</span> <span class="token variant variable">`Fuga</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">val</span> f <span class="token punctuation">:</span> bool <span class="token operator">-></span> <span class="token punctuation">[</span><span class="token operator">></span> <span class="token variant variable">`Fuga</span> <span class="token operator">|</span> <span class="token variant variable">`Hoge</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token keyword">fun</span><span class="token operator">></span>
</code></pre>
            <pre><code class="language-ocaml"># <span class="token keyword">let</span> hoge <span class="token operator">=</span> <span class="token keyword">function</span>
  <span class="token operator">|</span> <span class="token variant variable">`Hoge</span> <span class="token operator">-></span> <span class="token string">"hoge"</span>
  <span class="token operator">|</span> <span class="token variant variable">`Fuga</span> <span class="token operator">-></span> <span class="token string">"fuga"</span>
  <span class="token operator">|</span> <span class="token variant variable">`Piyo</span> <span class="token operator">-></span> <span class="token string">"piyo"</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">val</span> hoge <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token operator">&lt;</span> <span class="token variant variable">`Fuga</span> <span class="token operator">|</span> <span class="token variant variable">`Hoge</span> <span class="token operator">|</span> <span class="token variant variable">`Piyo</span> <span class="token punctuation">]</span> <span class="token operator">-></span> string <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token keyword">fun</span><span class="token operator">></span>
</code></pre>
            <h4>多态变种的类型方案</h4>
            <p>[&gt; …] , [&lt;…] 是类型方案 (同 `a)</p>
            <p>[&gt; …] 和 [&lt; …] 它被视为有限制的类型变量。</p>
            <p>在 [&gt; …] 的情况下
              [&gt; 可以解释为 “包含多态变种” 或更高。</p>
            <pre><code class="language-ocaml"><span class="token comment">(* 
 * 可以接受任何东西的多相变体列表
 *)</span>
# <span class="token keyword">let</span>  a <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token operator">></span><span class="token punctuation">]</span> list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token variant variable">`Fuga</span><span class="token punctuation">;</span> <span class="token variant variable">`Piyo</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">val</span> a <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token operator">></span> <span class="token variant variable">`Fuga</span> <span class="token operator">|</span> <span class="token variant variable">`Piyo</span> <span class="token punctuation">]</span> list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token variant variable">`Fuga</span><span class="token punctuation">;</span> <span class="token variant variable">`Piyo</span><span class="token punctuation">]</span>

# a <span class="token operator">@</span> <span class="token punctuation">[</span><span class="token variant variable">`Asdf</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token operator">></span> <span class="token variant variable">`Asdf</span> <span class="token operator">|</span> <span class="token variant variable">`Fuga</span> <span class="token operator">|</span> <span class="token variant variable">`Piyo</span> <span class="token punctuation">]</span> list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token variant variable">`Fuga</span><span class="token punctuation">;</span> <span class="token variant variable">`Piyo</span><span class="token punctuation">;</span> <span class="token variant variable">`Asdf</span><span class="token punctuation">]</span>
</code></pre>
            <p>在 [&lt;…] 中</p>
            <p>[&lt; 可以被解释为“在所包含的多相变体类型中”。</p>
            <pre><code class="language-ocaml"><span class="token comment">(* `Hoge,`within Fuga *)</span>
# <span class="token keyword">let</span> f <span class="token operator">=</span> <span class="token keyword">function</span>
  <span class="token operator">|</span> <span class="token variant variable">`Hoge</span> <span class="token operator">-></span> <span class="token string">"hoge"</span>
  <span class="token operator">|</span> <span class="token variant variable">`Fuga</span> <span class="token operator">-></span> <span class="token string">"fuga"</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">val</span> f <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token operator">&lt;</span> <span class="token variant variable">`Fuga</span> <span class="token operator">|</span> <span class="token variant variable">`Hoge</span> <span class="token punctuation">]</span> <span class="token operator">-></span> string <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token keyword">fun</span><span class="token operator">></span>

<span class="token comment">(* `Hoge, type within Fuga *)</span>
# <span class="token keyword">type</span> type_A <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token variant variable">`Hoge</span> <span class="token operator">|</span> <span class="token variant variable">`Fuga</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> type_A <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token variant variable">`Fuga</span> <span class="token operator">|</span> <span class="token variant variable">`Hoge</span> <span class="token punctuation">]</span>
# <span class="token keyword">let</span> a<span class="token punctuation">:</span>type_A <span class="token operator">=</span> <span class="token variant variable">`Hoge</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">val</span> a <span class="token punctuation">:</span> type_A <span class="token operator">=</span> <span class="token variant variable">`Hoge</span>
# f a<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">:</span> string <span class="token operator">=</span> <span class="token string">"hoge"</span>

<span class="token comment">(* `Hoge,`Fuga or more types *)</span>
# <span class="token keyword">type</span> type_B <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token variant variable">`Hoge</span> <span class="token operator">|</span> <span class="token variant variable">`Fuga</span> <span class="token operator">|</span> <span class="token variant variable">`Piyo</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> type_B <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token variant variable">`Fuga</span> <span class="token operator">|</span> <span class="token variant variable">`Hoge</span> <span class="token operator">|</span> <span class="token variant variable">`Piyo</span> <span class="token punctuation">]</span>

<span class="token comment">(* `I'm Hoge type_B is `Hoge, `Fuga or more types *)</span>
# <span class="token keyword">let</span> b<span class="token punctuation">:</span>type_B <span class="token operator">=</span> <span class="token variant variable">`Hoge</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">val</span> b <span class="token punctuation">:</span> type_B <span class="token operator">=</span> <span class="token variant variable">`Hoge</span>
# f b<span class="token punctuation">;</span><span class="token punctuation">;</span> <span class="token comment">(* type error　*)</span>
<span class="token module variable">Error</span><span class="token punctuation">:</span> <span class="token module variable">This</span> expression has <span class="token keyword">type</span> type_B but an expression was expected <span class="token keyword">of</span> <span class="token keyword">type</span>
         <span class="token punctuation">[</span><span class="token operator">&lt;</span> <span class="token variant variable">`Fuga</span> <span class="token operator">|</span> <span class="token variant variable">`Hoge</span> <span class="token punctuation">]</span>
       <span class="token module variable">The</span> second variant <span class="token keyword">type</span> does not allow tag<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token variant variable">`Piyo</span>
</code></pre>
            <h4>多态变体类型的定义</h4>
            <p>[&gt; …] [&lt;…] 无法使用的模式</p>
            <p>type hoge = [<code>Hoge |</code>Fuga |…]</p>
            <p>声明一个类型变量 [&gt; …] 和 [&lt;…] 定义一个模式</p>
            <p>type ‘a hoge = [&gt; `Hoge …] as’ a</p>
            <pre><code class="language-ocaml"># <span class="token keyword">type</span> hoge <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token variant variable">`Hoge</span> <span class="token operator">|</span> <span class="token variant variable">`Fuga</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> hoge <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token variant variable">`Fuga</span> <span class="token operator">|</span> <span class="token variant variable">`Hoge</span> <span class="token punctuation">]</span>

# <span class="token keyword">type</span> <span class="token type_variable function">'a</span> hoge <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">></span> <span class="token variant variable">`Hoge</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token type_variable function">'a</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token type_variable function">'a</span> hoge <span class="token operator">=</span> <span class="token type_variable function">'a</span> <span class="token keyword">constraint</span> <span class="token type_variable function">'a</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">></span> <span class="token variant variable">`Hoge</span> <span class="token punctuation">]</span>

# <span class="token keyword">type</span> <span class="token type_variable function">'a</span> hoge <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">&lt;</span> <span class="token variant variable">`Hoge</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token type_variable function">'a</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token type_variable function">'a</span> hoge <span class="token operator">=</span> <span class="token type_variable function">'a</span> <span class="token keyword">constraint</span> <span class="token type_variable function">'a</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">&lt;</span> <span class="token variant variable">`Hoge</span> <span class="token punctuation">]</span>

<span class="token comment">(* 类型定义可以重用 *)</span>
# <span class="token keyword">type</span> hoge' <span class="token operator">=</span> <span class="token punctuation">[</span>hoge <span class="token operator">|</span> <span class="token variant variable">`Piyo</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> hoge' <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token variant variable">`Fuga</span> <span class="token operator">|</span> <span class="token variant variable">`Hoge</span> <span class="token operator">|</span> <span class="token variant variable">`Piyo</span> <span class="token punctuation">]</span>
</code></pre>
            <h4>递归定义多相变量</h4>
            <h5>type 'a mylist = Nil | Cons of 'a * 'a mylist 我们将其定义为多相变量</h5>
            <ul>
              <li>首先按顺序定义它，并检查Valiant类型发生了什么</li>
            </ul>
            <pre><code class="language-ocaml">（<span class="token operator">*</span>通过定义来查看价格类型的变化<span class="token operator">*</span>）
# <span class="token keyword">let</span> l1 <span class="token operator">=</span> <span class="token variant variable">`Nil</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">val</span> l1 <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token operator">></span> <span class="token variant variable">`Nil</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variant variable">`Nil</span>
# <span class="token keyword">let</span> l2 <span class="token operator">=</span> <span class="token variant variable">`Cons</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token variant variable">`Nil</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">val</span> l2 <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token operator">></span> <span class="token variant variable">`Cons</span> <span class="token keyword">of</span> int <span class="token operator">*</span> <span class="token punctuation">[</span><span class="token operator">></span> <span class="token variant variable">`Nil</span> <span class="token punctuation">]</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variant variable">`Cons</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token variant variable">`Nil</span><span class="token punctuation">)</span>

（<span class="token operator">*</span>你不能获得泛型类型定义<span class="token operator">*</span>）
# <span class="token keyword">let</span> l3 <span class="token operator">=</span> <span class="token variant variable">`Cons</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token variant variable">`Cons</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token variant variable">`Nil</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">val</span> l3 <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token operator">></span> <span class="token variant variable">`Cons</span> <span class="token keyword">of</span> int <span class="token operator">*</span> <span class="token punctuation">[</span><span class="token operator">></span> <span class="token variant variable">`Cons</span> <span class="token keyword">of</span> int <span class="token operator">*</span> <span class="token punctuation">[</span><span class="token operator">></span> <span class="token variant variable">`Nil</span> <span class="token punctuation">]</span> <span class="token punctuation">]</span> <span class="token punctuation">]</span> <span class="token operator">=</span>
  <span class="token variant variable">`Cons</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token variant variable">`Cons</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token variant variable">`Nil</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
            <ul>
              <li>如果你写一个执行任意列表处理的函数，你应该能够获得列表的通用术语类型定义…</li>
            </ul>
            <pre><code class="language-ocaml"><span class="token comment">(* 递归Variant类型的类型定义是...？ *)</span>
# <span class="token keyword">let</span> <span class="token keyword">rec</span> length <span class="token operator">=</span> <span class="token keyword">function</span>
  <span class="token operator">|</span> <span class="token variant variable">`Nil</span> <span class="token operator">-></span> <span class="token number">0</span>
  <span class="token operator">|</span> <span class="token variant variable">`Cons</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> l<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token number">1</span> <span class="token operator">+</span> length l<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token comment">(*
* [...]因为'a已被赋予变体类型定义的别名
*这个别名'a出现在[...]中，原来是一个递归的定义
*'由b给出的类型变量是一个也可以看出哪个是固定的类型
*)</span>

<span class="token keyword">val</span> length <span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">&lt;</span> <span class="token variant variable">`Cons</span> <span class="token keyword">of</span> <span class="token type_variable function">'b</span> <span class="token operator">*</span> <span class="token type_variable function">'a</span> <span class="token operator">|</span> <span class="token variant variable">`Nil</span> <span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token type_variable function">'a</span><span class="token punctuation">)</span> <span class="token operator">-></span> int <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token keyword">fun</span><span class="token operator">></span>
</code></pre>
            <pre><code class="language-ocaml"><span class="token comment">(* 函数在列表中选择*的最大值 *)</span>
# <span class="token keyword">let</span> <span class="token keyword">rec</span> max_list <span class="token operator">=</span> <span class="token keyword">function</span>
  <span class="token operator">|</span> <span class="token variant variable">`Cons</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token variant variable">`Nil</span><span class="token punctuation">)</span> <span class="token operator">-></span> x
  <span class="token operator">|</span> <span class="token variant variable">`Cons</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token variant variable">`Cons</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> l<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-></span>
    <span class="token keyword">if</span> x <span class="token operator">&lt;</span> y <span class="token keyword">then</span> max_list <span class="token punctuation">(</span><span class="token variant variable">`Cons</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> l<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">else</span> max_list <span class="token punctuation">(</span><span class="token variant variable">`Cons</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> l<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span>

<span class="token comment">(*
* [.. [..]] 是因为它的形式，可以看出长度大于或等于1
*)</span>
<span class="token keyword">val</span> max_list <span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token variant variable">`Cons</span> <span class="token keyword">of</span> <span class="token type_variable function">'a</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">&lt;</span> <span class="token variant variable">`Cons</span> <span class="token keyword">of</span> <span class="token type_variable function">'a</span> <span class="token operator">*</span> <span class="token type_variable function">'b</span> <span class="token operator">|</span> <span class="token variant variable">`Nil</span> <span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token type_variable function">'b</span><span class="token punctuation">)</span> <span class="token punctuation">]</span> <span class="token operator">-></span> <span class="token type_variable function">'a</span> <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token keyword">fun</span><span class="token operator">></span>
</code></pre>
            <h4>注意多相变异型</h4>
            <h5>注意 “&amp;”</h5>
            <p>如果多态变体＆出来，它表明，它输入失败</p>
            <p>例如，int＆float指示表示int和float，不能实现</p>
            <p>那么，在这种情况下，您应该查看函数定义等</p>
            <pre><code class="language-ocaml"># <span class="token keyword">let</span> f <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token variant variable">`A</span> x <span class="token operator">-></span> x<span class="token operator">+</span><span class="token number">1</span> <span class="token operator">|</span> <span class="token variant variable">`B</span> <span class="token operator">-></span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">val</span> f <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token operator">&lt;</span> <span class="token variant variable">`A</span> <span class="token keyword">of</span> int <span class="token operator">|</span> <span class="token variant variable">`B</span> <span class="token punctuation">]</span> <span class="token operator">-></span> int <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token keyword">fun</span><span class="token operator">></span>
# <span class="token keyword">let</span> g <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token variant variable">`A</span> x <span class="token operator">-></span> int_of_float x<span class="token operator">+</span><span class="token number">1</span> <span class="token operator">|</span> <span class="token variant variable">`B</span> <span class="token operator">-></span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">val</span> g <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token operator">&lt;</span> <span class="token variant variable">`A</span> <span class="token keyword">of</span> float <span class="token operator">|</span> <span class="token variant variable">`B</span> <span class="token punctuation">]</span> <span class="token operator">-></span> int <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token keyword">fun</span><span class="token operator">></span>

<span class="token comment">(*
*返回不正确的类型[int＆float]
* hoge＆fuga是一个不可行的类型，所以下面的类型定义是真实的[&lt;`B] - > Int
*)</span>

# <span class="token keyword">let</span> f_or_g b <span class="token operator">=</span> <span class="token keyword">if</span> b <span class="token keyword">then</span> f <span class="token keyword">else</span> g<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">val</span> f_or_g <span class="token punctuation">:</span> bool <span class="token operator">-></span> <span class="token punctuation">[</span><span class="token operator">&lt;</span> <span class="token variant variable">`A</span> <span class="token keyword">of</span> int <span class="token operator">&amp;</span> float <span class="token operator">|</span> <span class="token variant variable">`B</span> <span class="token punctuation">]</span> <span class="token operator">-></span> int <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token keyword">fun</span><span class="token operator">></span>
</code></pre>
            <h4>使用点</h4>
            <p>练习多相变量的正确使用所必需的。</p>
            <p>在很多情况下，应该使用正常的变体来完成。</p>
            <h4>奖励：你有多态记录吗？</h4>
            <p>如果有多相变量，是否还有多态记录（如``hoge：int’）？ 我想，但没有这样的事情。</p>
            <p>相反，OCaml对象可以提供等效的功能。</p>
            <p>然而，对象没有模式匹配，所以说它用得不多。</p>

          </div>
        </div>
      </div>
    </div>
  </body>

</html>