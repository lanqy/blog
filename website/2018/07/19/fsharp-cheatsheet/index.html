<!--
 * @Author: Leland
 * @Date: 2019-12-27 15:59:00
 * @Description: Description
 -->
<!doctype html>
<html>

  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui" />
    <title>F# 备忘单</title>
    <link href="/css/style.css" rel="stylesheet" />
    <meta name="description" content="F# 备忘单">
  </head>

  <body>
    <div>
      <div>
        <header class="header">
          <div class="container header-wrap">
            <h1 class="site-name">
              <a href="/">
                首页
              </a>
            </h1>
            <ul class="nav">
              <li class="nav-item">
                <a href="/about">关于</a>
              </li>
            </ul>
          </div>
        </header>
      </div>
      <div class="container main">
        <div class="page-body">
          <div class="markdown-body">
            <h1>F# 备忘单</h1>
            <p>译自：<a href="https://dungpa.github.io/fsharp-cheatsheet/">https://dungpa.github.io/fsharp-cheatsheet/</a></p>
            <p>这张备忘单浏览了一些 F# 3.0 的常用语法。如果您有任何意见，更正或建议添加内容，请打开问题或发送拉取请求到https://github.com/dungpa/fsharp-cheatsheet。</p>
            <h2>注释</h2>
            <p>块注释放在 (* 和 *) 之间。行注释从 // 开始并一直持续到行结束。</p>
            <pre><code class="language-text">(* 这是块注释 *)

// 这是行注释
</code></pre>
            <p>在 /// 允许我们使用 XML 标记生成文档后，XML 文档注释就会出现。</p>
            <pre><code class="language-fsharp"><span class="token comment">/// `let`关键字定义了一个（不可变的）值</span>
<span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">=</span> <span class="token number">2</span>
</code></pre>
            <h2>字符串</h2>
            <p>F# 字符串类型是 System.String 类型的别名。</p>
            <pre><code class="language-fsharp"><span class="token comment">/// 使用字符串连接创建字符串</span>
<span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token string">"Hello"</span> <span class="token operator">+</span> <span class="token string">"World"</span>
</code></pre>
            <p>使用以 @ 符号开头的逐字字符串以避免转义控制字符（除了通过 “” 转义 &quot;）。</p>
            <pre><code class="language-fsharp"><span class="token keyword">let</span> verbatimXml <span class="token operator">=</span> <span class="token string">@"&lt;book title="" Paradise Lost "">"</span>
</code></pre>
            <p>我们甚至不必转义 &quot; 使用三引号字符串。</p>
            <pre><code class="language-fsharp"><span class="token keyword">let</span> tripleXml <span class="token operator">=</span> <span class="token string">"""&lt;book title="Paradise Lost">"""</span>
</code></pre>
            <p>反斜杠字符串通过去除前导空格来缩进字符串内容。</p>
            <pre><code class="language-fsharp"><span class="token keyword">let</span> poem <span class="token operator">=</span> 
    <span class="token string">"The lesser world was daubed\n\
     By a colorist of modest skill\n\
     A master limned you in the finest inks\n\
     And with a fresh-cut quill."</span>
</code></pre>
            <h2>基本类型和文字</h2>
            <p>大多数数字类型都有相关的后缀，例如，uy 表示无符号 8 位整数，L 表示有符号 64 位整数。</p>
            <pre><code class="language-fsharp"><span class="token keyword">let</span> b<span class="token punctuation">,</span> i<span class="token punctuation">,</span> l <span class="token operator">=</span> <span class="token number">86uy</span><span class="token punctuation">,</span> <span class="token number">86</span><span class="token punctuation">,</span> <span class="token number">86L</span>

<span class="token keyword">val</span> b <span class="token punctuation">:</span> <span class="token class-name">byte</span> <span class="token operator">=</span> <span class="token number">86uy</span>
<span class="token keyword">val</span> i <span class="token punctuation">:</span> <span class="token class-name">int</span> <span class="token operator">=</span> <span class="token number">86</span>
<span class="token keyword">val</span> l <span class="token punctuation">:</span> <span class="token class-name">int64</span> <span class="token operator">=</span> <span class="token number">86L</span>
</code></pre>
            <p>其他常见的例子是 32 位浮点数的 F 或 f ，小数的 M 或 m ，大整数的 I。</p>
            <pre><code class="language-fsharp"><span class="token keyword">let</span> s<span class="token punctuation">,</span> f<span class="token punctuation">,</span> d<span class="token punctuation">,</span> bi <span class="token operator">=</span> <span class="token number">4.14F</span><span class="token punctuation">,</span> <span class="token number">4.14</span><span class="token punctuation">,</span> <span class="token number">0.7833M</span><span class="token punctuation">,</span> <span class="token number">9999I</span>

<span class="token keyword">val</span> s <span class="token punctuation">:</span> <span class="token class-name">float32</span> <span class="token operator">=</span> <span class="token number">4.14f</span>
<span class="token keyword">val</span> f <span class="token punctuation">:</span> <span class="token class-name">float</span> <span class="token operator">=</span> <span class="token number">4.14</span>
<span class="token keyword">val</span> d <span class="token punctuation">:</span> <span class="token class-name">decimal</span> <span class="token operator">=</span> <span class="token number">0.7833M</span>
<span class="token keyword">val</span> bi <span class="token punctuation">:</span> <span class="token class-name">System<span class="token punctuation">.</span>Numerics<span class="token punctuation">.</span>BigInteger</span> <span class="token operator">=</span> <span class="token number">9999</span>
</code></pre>
            <p>有关完整参考，请<a href="http://msdn.microsoft.com/en-us/library/dd233193.aspx">参阅文字（MSDN）</a>。</p>
            <h2>函数</h2>
            <p>let 关键字还定义了命名函数。</p>
            <pre><code class="language-fsharp"><span class="token keyword">let</span> negate x <span class="token operator">=</span> x <span class="token operator">*</span> <span class="token operator">-</span><span class="token number">1</span>
<span class="token keyword">let</span> square x <span class="token operator">=</span> x <span class="token operator">*</span> x
<span class="token keyword">let</span> print x <span class="token operator">=</span> printfn <span class="token string">"The number is: %d"</span> x

<span class="token keyword">let</span> squareNegateThenPrint x <span class="token operator">=</span> 
    print <span class="token punctuation">(</span>negate <span class="token punctuation">(</span>square x<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
            <h3>管道和组合操作符</h3>
            <p>管道运算符 |&gt; 用于将函数和参数链接在一起。双重反引号标识符便于提高可读性，尤其是在单元测试中：</p>
            <pre><code class="language-fsharp"><span class="token keyword">let</span> ``square<span class="token punctuation">,</span> negate<span class="token punctuation">,</span> <span class="token keyword">then</span> print`` x <span class="token operator">=</span> 
    x <span class="token operator">|></span> square <span class="token operator">|></span> negate <span class="token operator">|></span> print
</code></pre>
            <p>此运算符在使用前通过提供类型信息来协助 F# 类型检查器是必不可少的：</p>
            <pre><code class="language-fsharp"><span class="token keyword">let</span> sumOfLengths <span class="token punctuation">(</span>xs <span class="token punctuation">:</span> <span class="token class-name">string</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=</span>
    xs
    <span class="token operator">|></span> Array<span class="token punctuation">.</span>map <span class="token punctuation">(</span><span class="token keyword">fun</span> s <span class="token operator">-></span> s<span class="token punctuation">.</span>Length<span class="token punctuation">)</span>
    <span class="token operator">|></span> Array<span class="token punctuation">.</span>sum
</code></pre>
            <p>组合运算符 &gt;&gt; 用于组合函数：</p>
            <pre><code class="language-fsharp"><span class="token keyword">let</span> squareNegateThenPrint' <span class="token operator">=</span> 
    square <span class="token operator">>></span> negate <span class="token operator">>></span> print
</code></pre>
            <h3>递归函数</h3>
            <p>rec 关键字与 let 关键字一起用于定义递归函数：</p>
            <pre><code class="language-fsharp"><span class="token keyword">let</span> <span class="token keyword">rec</span> fact x <span class="token operator">=</span> 
    <span class="token keyword">if</span> x <span class="token operator">&lt;</span> <span class="token number">1</span> <span class="token keyword">then</span> <span class="token number">1</span>
    <span class="token keyword">else</span> x <span class="token operator">*</span> fact <span class="token punctuation">(</span>x <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
</code></pre>
            <p>相互递归函数（那些相互调用的函数）由 and 关键字表示：</p>
            <pre><code class="language-fsharp"><span class="token keyword">let</span> <span class="token keyword">rec</span> even x <span class="token operator">=</span> 
    <span class="token keyword">if</span> x <span class="token operator">=</span> <span class="token number">0</span> <span class="token keyword">then</span> <span class="token keyword">true</span>
    <span class="token keyword">else</span> odd <span class="token punctuation">(</span>x <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">end</span> odd x <span class="token operator">=</span> 
    <span class="token keyword">if</span> x <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">then</span> <span class="token keyword">true</span>
    <span class="token keyword">else</span> even <span class="token punctuation">(</span>x <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
</code></pre>
            <h2>模式匹配</h2>
            <p>通常通过 match 关键字来促进模式匹配。</p>
            <pre><code class="language-fsharp"><span class="token keyword">let</span> <span class="token keyword">rec</span> fib n <span class="token operator">=</span> 
    <span class="token keyword">match</span> n <span class="token keyword">with</span>
    <span class="token operator">|</span> <span class="token number">0</span> <span class="token operator">-></span> <span class="token number">0</span>
    <span class="token operator">|</span> <span class="token number">1</span> <span class="token operator">-></span> <span class="token number">1</span>
    <span class="token operator">|</span> _ <span class="token operator">-></span> fib <span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> fib <span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span>
</code></pre>
            <p>为了匹配复杂的输入，可以使用 when 在模式上创建过滤器或防护：</p>
            <pre><code class="language-fsharp"><span class="token keyword">let</span> sign x <span class="token operator">=</span> 
    <span class="token keyword">match</span> x <span class="token keyword">with</span>
    <span class="token operator">|</span> <span class="token number">0</span> <span class="token operator">-></span> <span class="token number">0</span>
    <span class="token operator">|</span> x <span class="token keyword">when</span> x <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">-></span> <span class="token operator">-</span><span class="token number">1</span>
    <span class="token operator">|</span> x <span class="token operator">-></span> <span class="token number">1</span>
</code></pre>
            <p>模式匹配可以直接在参数上完成：</p>
            <pre><code class="language-fsharp"><span class="token keyword">let</span> fst' <span class="token punctuation">(</span>x<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=</span> x
</code></pre>
            <p>或通过 function 关键字隐式：</p>
            <pre><code class="language-fsharp"><span class="token comment">/// 类似于 `fib`;使用 `function` 进行模式匹配</span>
<span class="token keyword">let</span> <span class="token keyword">rec</span> fib' <span class="token operator">=</span> <span class="token keyword">function</span>
    <span class="token operator">|</span> <span class="token number">0</span> <span class="token operator">-></span> <span class="token number">0</span>
    <span class="token operator">|</span> <span class="token number">1</span> <span class="token operator">-></span> <span class="token number">1</span>
    <span class="token operator">|</span> n <span class="token operator">-></span> fib' <span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> fib' <span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span>
</code></pre>
            <p>有关更完整的参考，请访问<a href="http://msdn.microsoft.com/en-us/library/dd547125.aspx">模式匹配（MSDN）</a>。</p>
            <h2>集合</h2>
            <h3>列表</h3>
            <p>列表是相同类型的元素的不可变集合。</p>
            <pre><code class="language-fsharp"><span class="token comment">// 列表使用方括号和`;`分隔符</span>
<span class="token keyword">let</span> list1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"a"</span><span class="token punctuation">;</span><span class="token string">"b"</span><span class="token punctuation">]</span>
<span class="token comment">// :: 用于将元素加在列表开头</span>
<span class="token keyword">let</span> list2 <span class="token operator">=</span> <span class="token string">"c"</span> <span class="token operator">::</span> list1
<span class="token comment">// @ 用于连接列表</span>
<span class="token keyword">let</span> list3 <span class="token operator">=</span> list1 @ list2

<span class="token comment">// 使用( :: )运算符在列表上递归</span>
<span class="token keyword">let</span> <span class="token keyword">rec</span> sum list <span class="token operator">=</span> 
    <span class="token keyword">match</span> list <span class="token keyword">with</span>
    <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">-></span> <span class="token number">0</span>
    <span class="token operator">|</span> x <span class="token operator">::</span> xs <span class="token operator">-></span> x <span class="token operator">+</span> sum xs
</code></pre>
            <h3>数组</h3>
            <p>数组是连续数据元素的固定大小，从零开始，可变的集合。</p>
            <pre><code class="language-fsharp"><span class="token comment">// 数组使用方括号和条形</span>
<span class="token keyword">let</span> array1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">|</span><span class="token string">"a"</span><span class="token punctuation">;</span><span class="token string">"c"</span><span class="token operator">|</span><span class="token punctuation">]</span>
<span class="token comment">// 使用点进行索引访问</span>
<span class="token keyword">let</span> first <span class="token operator">=</span> array1<span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
</code></pre>
            <h3>序列</h3>
            <p>序列是相同类型的逻辑系列元素。仅根据需要计算各个序列元素，因此在不使用所有元素的情况下，序列可以提供比列表更好的性能。</p>
            <pre><code class="language-fsharp"><span class="token comment">// 序列可以使用 yield 并包含子序列</span>
<span class="token keyword">let</span> seq1 <span class="token operator">=</span> 
    <span class="token computation-expression keyword">seq</span> <span class="token punctuation">{</span>
        <span class="token comment">// “yield”增加一个元素</span>
        <span class="token keyword">yield</span> <span class="token number">1</span>
        <span class="token keyword">yield</span> <span class="token number">2</span>

        <span class="token comment">// "yield!" 添加一个完整的子序列</span>
        <span class="token keyword">yield!</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">.</span><span class="token number">.10</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>

</code></pre>
            <h3>集合上的高阶函数</h3>
            <p>同样的清单 [1; 3; 5; 7; 9] 或数组 [| 1; 3; 5; 7; 9 |] 可以以各种方式生成。</p>
            <ul>
              <li>使用范围运算符…</li>
            </ul>
            <pre><code class="language-fsharp"><span class="token keyword">let</span> xs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token number">.2</span><span class="token punctuation">.</span><span class="token number">.9</span><span class="token punctuation">]</span>
</code></pre>
            <ul>
              <li>使用列表或数组理解</li>
            </ul>
            <pre><code class="language-fsharp"><span class="token keyword">let</span> yx <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">|</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token number">.4</span> <span class="token operator">-></span> <span class="token number">2</span> <span class="token operator">*</span> i <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">|</span><span class="token punctuation">]</span>
</code></pre>
            <ul>
              <li>使用 init 函数</li>
            </ul>
            <pre><code class="language-fsharp"><span class="token keyword">let</span> zs <span class="token operator">=</span> List<span class="token punctuation">.</span>init <span class="token number">5</span> <span class="token punctuation">(</span><span class="token keyword">fun</span> i <span class="token operator">-></span> <span class="token number">2</span> <span class="token operator">*</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
</code></pre>
            <p>列表和数组具有用于操作的全面的高阶函数集。</p>
            <ul>
              <li>fold 从列表（或数组）的左侧开始，foldBack 的方向相反</li>
            </ul>
            <pre><code class="language-fsharp"><span class="token keyword">let</span> xs' <span class="token operator">=</span> Array<span class="token punctuation">.</span>fold <span class="token punctuation">(</span><span class="token keyword">fun</span> str n <span class="token operator">-></span> sprintf <span class="token string">"%s,%i"</span> str n<span class="token punctuation">)</span> <span class="token string">""</span> <span class="token punctuation">[</span><span class="token operator">|</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token number">.9</span><span class="token operator">|</span><span class="token punctuation">]</span>
</code></pre>
            <ul>
              <li>reduce 不需要初始累加器</li>
            </ul>
            <pre><code class="language-fsharp"><span class="token keyword">let</span> last xs <span class="token operator">=</span> List<span class="token punctuation">.</span>reduce <span class="token punctuation">(</span><span class="token keyword">fun</span> acc x <span class="token operator">-></span> x<span class="token punctuation">)</span> xs
</code></pre>
            <ul>
              <li>map 转换列表（或数组）的每个元素</li>
            </ul>
            <pre><code class="language-fsharp"><span class="token keyword">let</span> ys' <span class="token operator">=</span> Array<span class="token punctuation">.</span>map <span class="token punctuation">(</span><span class="token keyword">fun</span> x <span class="token operator">-></span> x <span class="token operator">*</span> x<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token operator">|</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token number">.9</span><span class="token operator">|</span><span class="token punctuation">]</span>
</code></pre>
            <ul>
              <li>iter 列表并产生副作用</li>
            </ul>
            <pre><code class="language-fsharp"><span class="token keyword">let</span> _ <span class="token operator">=</span> List<span class="token punctuation">.</span>iter <span class="token punctuation">(</span>printfn <span class="token string">"%i"</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token number">.9</span><span class="token punctuation">]</span>
</code></pre>
            <p>所有这些操作也可用于序列。序列的附加好处是对实现 IEnumerable&lt;'T&gt; 的所有集合的懒惰和统一处理。</p>
            <pre><code class="language-fsharp"><span class="token keyword">let</span> zs' <span class="token operator">=</span> 
    <span class="token computation-expression keyword">seq</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token number">.9</span> <span class="token keyword">do</span>
            printfn <span class="token string">"Adding %d"</span> i
            <span class="token keyword">yield</span> i
    <span class="token punctuation">}</span>
</code></pre>
            <h2>元组和记录</h2>
            <p>元组是一组未命名但有序的值，可能是不同类型的：</p>
            <pre><code class="language-fsharp"><span class="token comment">// 元组结构</span>
<span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"Hello"</span><span class="token punctuation">)</span>

<span class="token comment">// 三重</span>
<span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">"one"</span><span class="token punctuation">,</span> <span class="token string">"two"</span><span class="token punctuation">,</span> <span class="token string">"three"</span><span class="token punctuation">)</span>

<span class="token comment">// 元组解构/模式</span>
<span class="token keyword">let</span> <span class="token punctuation">(</span>a'<span class="token punctuation">,</span> b'<span class="token punctuation">)</span> <span class="token operator">=</span> x
</code></pre>
            <p>可以使用 fst，snd 或模式匹配获得元组的第一个和第二个元素：</p>
            <pre><code class="language-fsharp"><span class="token keyword">let</span> c' <span class="token operator">=</span> fst <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> d' <span class="token operator">=</span> snd <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> print' tuple <span class="token operator">=</span> 
    <span class="token keyword">match</span> tuple <span class="token keyword">with</span>
    <span class="token operator">|</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">-></span> printfn <span class="token string">"Pair %A %A"</span> a b
</code></pre>
            <p>记录表示命名值的简单聚合，可选择包含成员：</p>
            <pre><code class="language-fsharp"><span class="token comment">// 声明记录类型</span>
<span class="token keyword">type</span> <span class="token class-name">Person</span> <span class="token operator">=</span> <span class="token punctuation">{</span> Name<span class="token punctuation">:</span> <span class="token class-name">string</span><span class="token punctuation">;</span> Age<span class="token punctuation">:</span> <span class="token class-name">int</span> <span class="token punctuation">}</span>

<span class="token comment">// 通过记录表达式创建值</span>
<span class="token keyword">let</span> paul <span class="token operator">=</span> <span class="token punctuation">{</span> Name <span class="token operator">=</span> <span class="token string">"Paul"</span><span class="token punctuation">;</span> Age <span class="token operator">=</span> <span class="token number">28</span><span class="token punctuation">}</span>

<span class="token comment">// '复制并更新'记录表达式</span>
<span class="token keyword">let</span> paulsTwin <span class="token operator">=</span> <span class="token punctuation">{</span>paul <span class="token keyword">with</span> Name <span class="token operator">=</span> <span class="token string">"Jim"</span><span class="token punctuation">}</span>

</code></pre>
            <p>记录可以使用属性和方法进行扩充：</p>
            <pre><code class="language-fsharp"><span class="token keyword">type</span> <span class="token class-name">Person</span> <span class="token keyword">with</span>
    <span class="token keyword">member</span> x<span class="token punctuation">.</span>Info <span class="token operator">=</span> <span class="token punctuation">(</span>x<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> x<span class="token punctuation">.</span>Age<span class="token punctuation">)</span>
</code></pre>
            <p>记录本质上是带有额外顶部的密封类：默认不变性，结构相等和模式匹配支持。</p>
            <pre><code class="language-fsharp"><span class="token keyword">let</span> isPaul person <span class="token operator">=</span> 
    <span class="token keyword">match</span> person <span class="token keyword">with</span>
    <span class="token operator">|</span> <span class="token punctuation">{</span> Name <span class="token operator">=</span> <span class="token string">"Paul"</span> <span class="token punctuation">}</span> <span class="token operator">-></span> <span class="token keyword">true</span>
    <span class="token operator">|</span> _ <span class="token operator">-></span> <span class="token keyword">false</span>
</code></pre>
            <h2>识别联合</h2>
            <p>识别联合（DU）为可以是多个命名案例之一的值提供支持，每个案例可能具有不同的值和类型。</p>
            <pre><code class="language-fsharp"><span class="token keyword">type</span> <span class="token class-name">Tree</span><span class="token operator">&lt;</span>'T<span class="token operator">></span> <span class="token operator">=</span>
    <span class="token operator">|</span> Node <span class="token keyword">of</span> <span class="token class-name">Tree</span><span class="token operator">&lt;</span>'T<span class="token operator">></span> <span class="token operator">*</span> 'T <span class="token operator">*</span> Tree<span class="token operator">&lt;</span>'T<span class="token operator">></span>
    <span class="token operator">|</span> Leaf

<span class="token keyword">let</span> <span class="token keyword">rec</span> depth <span class="token operator">=</span> <span class="token keyword">function</span> 
    <span class="token operator">|</span> <span class="token function">Node</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> _<span class="token punctuation">,</span> r<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token number">1</span> <span class="token operator">+</span> max <span class="token punctuation">(</span>depth l<span class="token punctuation">)</span> <span class="token punctuation">(</span>depth r<span class="token punctuation">)</span>
    <span class="token operator">|</span> Leaf <span class="token operator">-></span> <span class="token number">0</span>
</code></pre>
            <p>F# Core 有一些用于错误处理的内置区分联合，例如 <a href="http://msdn.microsoft.com/en-us/library/dd233245.aspx">Option</a> 和 <a href="http://msdn.microsoft.com/en-us/library/ee353439.aspx">Choice</a> 。</p>
            <pre><code class="language-fsharp"><span class="token keyword">let</span> optionPatternMatch input <span class="token operator">=</span> 
    <span class="token keyword">match</span> input <span class="token keyword">with</span>
    <span class="token operator">|</span> Some i <span class="token operator">-></span> printfn <span class="token string">"input is an int=%d"</span> i
    <span class="token operator">|</span> None <span class="token operator">-></span> printfn <span class="token string">"input is missing"</span>
</code></pre>
            <p>单例区分联合通常用于创建具有模式匹配支持的类型安全抽象：</p>
            <pre><code class="language-fsharp"><span class="token keyword">type</span> <span class="token class-name">OrderId</span> <span class="token operator">=</span> Order <span class="token keyword">of</span> <span class="token class-name">string</span>

<span class="token comment">// 创建DU值</span>
<span class="token keyword">let</span> orderId <span class="token operator">=</span> Order <span class="token string">"12"</span>

<span class="token comment">// 使用模式匹配来解构单个案例 DU</span>
<span class="token keyword">let</span> <span class="token punctuation">(</span>Order id<span class="token punctuation">)</span> <span class="token operator">=</span> orderId
</code></pre>
            <h2>异常</h2>
            <p>failwith 函数抛出异常类型 Exception 。</p>
            <pre><code class="language-fsharp"><span class="token keyword">let</span> divideFailwith x y <span class="token operator">=</span> 
    <span class="token keyword">if</span> y <span class="token operator">=</span> <span class="token number">0</span> <span class="token keyword">then</span>
        failwith <span class="token string">"Divisor cannot be zero"</span>
    <span class="token keyword">else</span> x <span class="token operator">/</span> y
</code></pre>
            <p>异常处理通过 try / with 表达式完成。</p>
            <pre><code class="language-fsharp"><span class="token keyword">let</span> divide x y <span class="token operator">=</span>
    <span class="token keyword">try</span>
        Some <span class="token punctuation">(</span>x <span class="token operator">/</span> y<span class="token punctuation">)</span>
    <span class="token keyword">with</span> <span class="token operator">:?</span> System<span class="token punctuation">.</span>DivideByZeroException <span class="token operator">-></span>
        printfn <span class="token string">"Division by zero!"</span>
        None
</code></pre>
            <p>try / finally 表达式使您可以执行清理代码，即使代码块引发异常也是如此。这是一个定义自定义异常的示例。</p>
            <pre><code class="language-fsharp"><span class="token keyword">exception</span> <span class="token class-name">InnerError</span> <span class="token keyword">of</span> <span class="token class-name">string</span>
<span class="token keyword">exception</span> <span class="token class-name">OuterError</span> <span class="token keyword">of</span> <span class="token class-name">string</span>

<span class="token keyword">let</span> handleErrors x y <span class="token operator">=</span>
    <span class="token keyword">try</span>
        <span class="token keyword">try</span>
            <span class="token keyword">if</span> x <span class="token operator">=</span> y <span class="token keyword">then</span> raise <span class="token punctuation">(</span><span class="token function">InnerError</span><span class="token punctuation">(</span><span class="token string">"inner"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span> raise <span class="token punctuation">(</span><span class="token function">OuterError</span><span class="token punctuation">(</span><span class="token string">"outer"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">with</span>
            printfn <span class="token string">"Error1 %s"</span> str
    <span class="token keyword">finally</span>
        printfn <span class="token string">"Always print this."</span>
</code></pre>
            <h2>类和继承</h2>
            <p>此示例是一个基本类，包含（1）本地 let 绑定，（2）属性，（3）方法和（4）静态成员。</p>
            <pre><code class="language-fsharp"><span class="token keyword">type</span> <span class="token class-name">Vector</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token class-name">float</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token class-name">float</span><span class="token punctuation">)</span> <span class="token operator">=</span>
    <span class="token keyword">let</span> mag <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span>x <span class="token operator">*</span> x <span class="token operator">+</span> y <span class="token operator">*</span> y<span class="token punctuation">)</span> <span class="token comment">// (1)</span>
    <span class="token keyword">member</span> this<span class="token punctuation">.</span>X <span class="token operator">=</span> x <span class="token comment">// (2)</span>
    <span class="token keyword">member</span> this<span class="token punctuation">.</span>Y <span class="token operator">=</span> y
    <span class="token keyword">member</span> this<span class="token punctuation">.</span>Mag <span class="token operator">=</span> mag
    <span class="token keyword">member</span> this<span class="token punctuation">.</span><span class="token function">Scale</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token comment">// (3)</span>
        <span class="token function">Vector</span><span class="token punctuation">(</span>x <span class="token operator">*</span> s<span class="token punctuation">,</span> y <span class="token operator">*</span> s<span class="token punctuation">)</span>
    <span class="token keyword">static</span> <span class="token keyword">member</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>a<span class="token punctuation">:</span> <span class="token class-name">Vector</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token class-name">Vector</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token comment">// (4)</span>
        <span class="token function">Vector</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>X <span class="token operator">+</span> b<span class="token punctuation">.</span>X<span class="token punctuation">,</span> a<span class="token punctuation">.</span>Y <span class="token operator">+</span> b<span class="token punctuation">.</span>Y<span class="token punctuation">)</span>
</code></pre>
            <p>从派生类调用基类。</p>
            <pre><code class="language-fsharp"><span class="token keyword">type</span> <span class="token class-name">Animal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span>
    <span class="token keyword">member</span> __<span class="token punctuation">.</span><span class="token function">Reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">type</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> 
    <span class="token keyword">inherit</span> <span class="token class-name">Animal</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">member</span> __<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span>
        <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">Reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
            <p>上传表示为 :&gt; 运算符。</p>
            <pre><code class="language-fsharp"><span class="token keyword">let</span> dog <span class="token operator">=</span> <span class="token function">Dog</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> animal <span class="token operator">=</span> dog <span class="token operator">:></span> <span class="token class-name">Animal</span>
</code></pre>
            <p>如果转换在运行时未成功，则动态向下转换（ :?&gt; ）可能会抛出 InvalidCastException。</p>
            <pre><code class="language-fsharp"><span class="token keyword">let</span> shouldBeDog <span class="token operator">=</span> animal <span class="token operator">:?></span> <span class="token class-name">Dog</span>
</code></pre>
            <h2>接口和对象表达式</h2>
            <p>声明 IVector 接口并在 Vector’ 中实现它。</p>
            <pre><code class="language-fsharp"><span class="token keyword">type</span> <span class="token class-name">IVector</span>
    <span class="token keyword">abstract</span> Scale <span class="token punctuation">:</span> <span class="token class-name">float <span class="token operator">-></span> IVector</span>

<span class="token keyword">type</span> <span class="token class-name">Vector</span>'<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">=</span> 
    <span class="token keyword">interface</span> <span class="token class-name">IVector</span> <span class="token keyword">with</span>
        <span class="token keyword">member</span> __<span class="token punctuation">.</span><span class="token function">Scale</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">=</span>
            Vector'<span class="token punctuation">(</span>x <span class="token operator">*</span> s<span class="token punctuation">,</span> y <span class="token operator">*</span> s<span class="token punctuation">)</span> <span class="token operator">:></span> <span class="token class-name">IVector</span>
    <span class="token keyword">member</span> __<span class="token punctuation">.</span>X <span class="token operator">=</span> x
    <span class="token keyword">member</span> __<span class="token punctuation">.</span>Y <span class="token operator">=</span> y
</code></pre>
            <p>实现接口的另一种方法是使用对象表达式。</p>
            <pre><code class="language-fsharp"><span class="token keyword">type</span> <span class="token class-name">ICustomer</span> <span class="token operator">=</span>
    <span class="token keyword">abstract</span> Name <span class="token punctuation">:</span> <span class="token class-name">string</span>
    <span class="token keyword">abstract</span> Age <span class="token punctuation">:</span> <span class="token class-name">int</span>

<span class="token keyword">let</span> createCustomer name age <span class="token operator">=</span> 
    <span class="token punctuation">{</span> <span class="token keyword">new</span> <span class="token class-name">ICustomer</span> <span class="token keyword">with</span>
        <span class="token keyword">member</span> __<span class="token punctuation">.</span>Name <span class="token operator">=</span> name
        <span class="token keyword">member</span> __<span class="token punctuation">.</span>Age <span class="token operator">=</span> age <span class="token punctuation">}</span>
</code></pre>
            <h2>活动模式</h2>
            <p>完整的活动模式：</p>
            <pre><code class="language-fsharp"><span class="token keyword">let</span> <span class="token punctuation">(</span><span class="token operator">|</span>Even<span class="token operator">|</span>Odd<span class="token operator">|</span><span class="token punctuation">)</span> i <span class="token operator">=</span> 
    <span class="token keyword">if</span> i <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token keyword">then</span> Even <span class="token keyword">else</span> Odd

<span class="token keyword">let</span> testNumber i <span class="token operator">=</span> 
    <span class="token keyword">match</span> i <span class="token keyword">with</span>
    <span class="token operator">|</span> Even <span class="token operator">-></span> printfn <span class="token string">"%d is even"</span> i
    <span class="token operator">|</span> Odd <span class="token operator">-></span> printfn <span class="token string">"%d is odd"</span> i
</code></pre>
            <p>参数化活动模式：</p>
            <pre><code class="language-fsharp"><span class="token keyword">let</span> <span class="token punctuation">(</span><span class="token operator">|</span>DivisibleBy<span class="token operator">|</span>_<span class="token operator">|</span><span class="token punctuation">)</span> by n <span class="token operator">=</span>
    <span class="token keyword">if</span> n <span class="token operator">%</span> by <span class="token operator">=</span> <span class="token number">0</span> <span class="token keyword">then</span> Some DivisibleBy <span class="token keyword">else</span> None

<span class="token keyword">let</span> fizzBuzz <span class="token operator">=</span> <span class="token keyword">function</span>
    <span class="token operator">|</span> DivisibleBy <span class="token number">3</span> <span class="token operator">&amp;</span> DivisibleBy <span class="token number">5</span> <span class="token operator">-></span> <span class="token string">"FizzBuzz"</span>
    <span class="token operator">|</span> DivisibleBy <span class="token number">3</span> <span class="token operator">-></span> <span class="token string">"Fizz"</span>
    <span class="token operator">|</span> DivisibleBy <span class="token number">5</span> <span class="token operator">-></span> <span class="token string">"Buzz"</span>
    <span class="token operator">|</span> i <span class="token operator">-></span> string i
</code></pre>
            <p>部分活动模式共享参数化模式的语法，但它们的主动识别器只接受一个参数。</p>
            <h2>编译器指令</h2>
            <p>将另一个 F# 源文件加载到 FSI 中。</p>
            <pre><code class="language-fsharp"><span class="token preprocessor property">#load </span><span class="token string">"../lib/StringParsing.fs"</span>
</code></pre>
            <p>引用.NET程序集（建议使用/符号以实现Mono兼容性）。</p>
            <pre><code class="language-fsharp"><span class="token preprocessor property">#r </span><span class="token string">"../lib/FSharp.Markdown.dll"</span>
</code></pre>
            <p>在程序集搜索路径中包含目录。</p>
            <pre><code class="language-fsharp"><span class="token preprocessor property">#I </span><span class="token string">"../lib"</span>
<span class="token preprocessor property">#r </span><span class="token string">"FSharp.Markdown.dll"</span>
</code></pre>
            <p>其他重要指令是 FSI（INTERACTIVE）中的条件执行和查询当前目录（ <strong>SOURCE_DIRECTORY</strong> ）。</p>
            <pre><code class="language-fsharp"><span class="token preprocessor property">#<span class="token directive keyword">if</span> INTERACTIVE</span>
<span class="token keyword">let</span> path <span class="token operator">=</span> __SOURCE_DIRECTORY__ <span class="token operator">+</span> <span class="token string">"../lib"</span>
<span class="token preprocessor property">#<span class="token directive keyword">else</span></span>
<span class="token keyword">let</span> path <span class="token operator">=</span> <span class="token string">"../../../lib"</span>
<span class="token preprocessor property">#<span class="token directive keyword">endif</span></span>
</code></pre>

          </div>
        </div>
      </div>
    </div>
  </body>

</html>